<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>clip_08t · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Chapter 0</span><ul><li><a class="toctext" href="../../00/clip_01_03/"><code>clip_01_03</code></a></li><li><a class="toctext" href="../../00/clip_04_05/"><code>clip_04_04</code></a></li></ul></li><li><span class="toctext">Chapter 2</span><ul><li><a class="toctext" href="../clip_01_02/"><code>clip_01_02</code></a></li><li><a class="toctext" href="../clip_03_05/"><code>clip_03_05</code></a></li><li><a class="toctext" href="../clip_06_07/"><code>clip_06_07</code></a></li><li class="current"><a class="toctext" href><code>clip_08t</code></a><ul class="internal"></ul></li><li><a class="toctext" href="../clip_08m/"><code>clip_08m</code></a></li><li><a class="toctext" href="../clip_08s/"><code>clip_08s</code></a></li></ul></li><li><span class="toctext">Chapter 3</span><ul><li><a class="toctext" href="../../03/clip_01/"><code>clip_01</code></a></li><li><a class="toctext" href="../../03/clip_02_05/"><code>clip_02_05</code></a></li><li><a class="toctext" href="../../03/clip_05s/"><code>clip_05s</code></a></li><li><a class="toctext" href="../../03/clip_06_16s/"><code>clip_06_16s</code></a></li></ul></li><li><span class="toctext">Chapter 4</span><ul><li><a class="toctext" href="../../04/clip_01_06/"><code>clip_01_06</code></a></li><li><a class="toctext" href="../../04/clip_07.0s/"><code>clip_07.0s</code></a></li><li><a class="toctext" href="../../04/clip_07.1s/"><code>clip_07.1s</code></a></li><li><a class="toctext" href="../../04/clip_38.0s/"><code>clip_38.0s</code></a></li><li><a class="toctext" href="../../04/clip_38.1s/"><code>clip_38.1s</code></a></li><li><a class="toctext" href="../../04/clip_38.2s/"><code>clip_38.2s</code></a></li><li><a class="toctext" href="../../04/clip_38.3s/"><code>clip_38.3s</code></a></li><li><a class="toctext" href="../../04/clip_38.0m/"><code>clip_38.0m</code></a></li><li><a class="toctext" href="../../04/clip_38.1m/"><code>clip_38.1m</code></a></li><li><a class="toctext" href="../../04/clip_43s/"><code>clip_43s</code></a></li><li><a class="toctext" href="../../04/clip_43t/"><code>clip_43t</code></a></li><li><a class="toctext" href="../../04/clip_45_47s/"><code>clip_45_47s</code></a></li><li><a class="toctext" href="../../04/clip_48_54s/"><code>clip_48_54s</code></a></li></ul></li><li><span class="toctext">Chapter 5</span><ul><li><a class="toctext" href="../../05/clip_01s/"><code>clip_01s</code></a></li></ul></li><li><span class="toctext">Chapter 8</span><ul><li><a class="toctext" href="../../08/m8.1/"><code>m8.1.jl</code></a></li><li><a class="toctext" href="../../08/m8.1t/"><code>m8.1t.jl</code></a></li><li><a class="toctext" href="../../08/m8.2/"><code>m8.2.jl</code></a></li><li><a class="toctext" href="../../08/m8.3/"><code>m8.3.jl</code></a></li><li><a class="toctext" href="../../08/m8.4/"><code>m8.4.jl</code></a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li><a class="toctext" href="../../10/m10.3/"><code>m10.3.jl</code></a></li><li><a class="toctext" href="../../10/m10.4/"><code>m10.4.jl</code></a></li></ul></li><li><span class="toctext">Chapter 11</span><ul><li><a class="toctext" href="../../11/m11_5/"><code>m11.5.jl</code></a></li></ul></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12_1/"><code>m12.1.jl</code></a></li><li><a class="toctext" href="../../12/m12_2/"><code>m12.2.jl</code></a></li><li><a class="toctext" href="../../12/m12_3/"><code>m12.3.jl</code></a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 2</li><li><a href><code>clip_08t</code></a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/docs/src/02/clip_08t.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>clip_08t</span><a class="fa fa-bars" href="#"></a></div></header><p>Load Julia packages (libraries) needed</p><pre><code class="language-julia">using StatisticalRethinking
using StatsFuns, Optim, Turing, Flux.Tracker
gr(size=(600,300));

Turing.setadbackend(:reverse_diff)</code></pre><pre><code class="language-none">loaded


┌ Warning: Package Turing does not have CmdStan in its dependencies:
│ - If you have Turing checked out for development and have
│   added CmdStan as a dependency but haven&#39;t updated your primary
│   environment&#39;s manifest file, try `Pkg.resolve()`.
│ - Otherwise you may need to report an issue with Turing
│ Loading CmdStan into Turing from project dependency, future warnings for Turing are suppressed.
└ @ nothing nothing:840
WARNING: using CmdStan.Sample in module Turing conflicts with an existing identifier.





:reverse_diff</code></pre><h3><a class="nav-anchor" id="snippet-2.8t-1" href="#snippet-2.8t-1">snippet 2.8t</a></h3><p>Define the data</p><pre><code class="language-julia">k = 6; n = 9;</code></pre><p>Define the model</p><pre><code class="language-julia">@model globe_toss(n, k) = begin
  theta ~ Beta(1, 1) # prior
  k ~ Binomial(n, theta) # model
  return k, theta
end;</code></pre><p>Compute the &quot;maximum<em>a</em>posteriori&quot; value</p><p>Set search bounds</p><pre><code class="language-julia">lb = [0.0]; ub = [1.0];</code></pre><p>Create (compile) the model</p><pre><code class="language-julia">model = globe_toss(n, k);</code></pre><p>Compute the maximum<em>a</em>posteriori</p><pre><code class="language-julia">result = maximum_a_posteriori(model, lb, ub)</code></pre><pre><code class="language-none">Results of Optimization Algorithm
 * Algorithm: Fminbox with L-BFGS
 * Starting Point: [0.43601313152405363]
 * Minimizer: [0.6666666665712192]
 * Minimum: 1.297811e+00
 * Iterations: 3
 * Convergence: true
   * |x - x&#39;| ≤ 0.0e+00: false 
     |x - x&#39;| = 7.68e-08 
   * |f(x) - f(x&#39;)| ≤ 0.0e+00 |f(x)|: false
     |f(x) - f(x&#39;)| = 9.22e-14 |f(x)|
   * |g(x)| ≤ 1.0e-08: true 
     |g(x)| = 3.11e-09 
   * Stopped by an increasing objective: false
   * Reached Maximum Number of Iterations: false
 * Objective Calls: 49
 * Gradient Calls: 49</code></pre><p>Use Turing mcmc</p><pre><code class="language-julia">Turing.turnprogress(false)
chn = sample(model, NUTS(2000, 1000, 0.65));</code></pre><pre><code class="language-none">┌ Info: [Turing]: global PROGRESS is set as false
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/Turing.jl:81
┌ Info: [Turing] looking for good initial eps...
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/samplers/support/hmc_core.jl:246
[NUTS{Union{}}] found initial ϵ: 0.8
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/samplers/support/hmc_core.jl:291
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/core/ad.jl:114
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/core/ad.jl:115
┌ Info:  Adapted ϵ = 0.9595407256254531, std = [1.0]; 1000 iterations is used for adaption.
└ @ Turing /Users/rob/.julia/packages/Turing/pRhjG/src/samplers/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 5.366160218000005;
  #lf / sample        = 0.0025;
  #evals / sample     = 6.8585;
  pre-cond. metric    = [1.0].</code></pre><p>Look at the generated draws (in chn)</p><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:2000
Thinning interval = 1
Chains = 1
Samples per chain = 2000

Empirical Posterior Estimates:
             Mean         SD       Naive SE       MCSE         ESS   
  lf_num  0.00250000 0.111803399 0.0025000000 0.0025000000 2000.00000
 elapsed  0.00268308 0.083443804 0.0018658602 0.0024022260 1206.59200
 epsilon  1.11832340 0.967841538 0.0216415947 0.0449674509  463.24632
   theta  0.64178990 0.133473620 0.0029845609 0.0032139864 1724.65731
      lp -3.26836903 0.699385284 0.0156387304 0.0257294314  738.87777
eval_num  6.85850000 3.987910413 0.0891723877 0.1334487384  893.02135
  lf_eps  1.11832340 0.967841538 0.0216415947 0.0449674509  463.24632

Quantiles:
              2.5%          25.0%        50.0%         75.0%          97.5%    
  lf_num  0.0000000000  0.00000000000  0.00000000  0.00000000000  0.00000000000
 elapsed  0.0001327437  0.00013531425  0.00014373  0.00034360475  0.00074923602
 epsilon  0.3871856393  0.95954072563  0.95954073  1.03236201414  2.72709112614
   theta  0.3712161929  0.54695523760  0.64940621  0.73885701268  0.87566668020
      lp -5.2978624719 -3.42597439130 -3.01414974 -2.82723625426 -2.77970959395
eval_num  4.0000000000  4.00000000000  4.00000000 10.00000000000 10.00000000000
  lf_eps  0.3871856393  0.95954072563  0.95954073  1.03236201414  2.72709112614</code></pre><p>Look at the mean and sd</p><pre><code class="language-julia">println(&quot;\ntheta = $(mean_and_std(chn[:theta][1001:2000]))\n&quot;)</code></pre><pre><code class="language-none">theta = (0.6416312990141793, 0.1311782682540063)</code></pre><p>Compute at hpd region</p><pre><code class="language-julia">bnds = MCMCChain.hpd(chn[:theta], alpha=0.06);</code></pre><p>analytical calculation</p><pre><code class="language-julia">w = 6; n = 9; x = 0:0.01:1
plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), fill=(0, .5,:orange), lab=&quot;Conjugate solution&quot;)</code></pre><p><img src="../output_23_0.svg" alt="svg"/></p><p>quadratic approximation</p><pre><code class="language-julia">plot!( x, pdf.(Normal( 0.67 , 0.16 ) , x ), lab=&quot;Normal approximation&quot;)</code></pre><p><img src="../output_25_0.svg" alt="svg"/></p><p>Turing Chain &amp;  89%hpd region boundaries</p><pre><code class="language-julia">density!(chn[:theta], lab=&quot;Turing chain&quot;)
vline!([bnds[1]], line=:dash, lab=&quot;hpd lower bound&quot;)
vline!([bnds[2]], line=:dash, lab=&quot;hpd upper bound&quot;)</code></pre><p><img src="../output_27_0.svg" alt="svg"/></p><p>Show hpd region</p><pre><code class="language-julia">println(&quot;hpd bounds = $bnds\n&quot;)</code></pre><pre><code class="language-none">hpd bounds = [0.390912, 0.87325]</code></pre><p>End of <code>clip_08t.jl</code></p><p><em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../clip_06_07/"><span class="direction">Previous</span><span class="title"><code>clip_06_07</code></span></a><a class="next" href="../clip_08m/"><span class="direction">Next</span><span class="title"><code>clip_08m</code></span></a></footer></article></body></html>
