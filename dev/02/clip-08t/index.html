<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>clip-08t · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../clip-08s/">clip-08s</a></li><li class="current"><a class="toctext" href>clip-08t</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/clip-01s/">clip-01s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1/">m8.1</a></li><li><a class="toctext" href="../../08/m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12.6.1s/">m12.6.1s</a></li><li><a class="toctext" href="../../12/m12.6.2s/">m12.6.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 02</li><li><a href>clip-08t</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/docs/src/02/clip-08t.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>clip-08t</span><a class="fa fa-bars" href="#"></a></div></header><p>Load Julia packages (libraries) needed</p><pre><code class="language-julia">using StatisticalRethinking
using Optim, Turing, Flux.Tracker
gr(size=(600,300));</code></pre><pre><code class="language-none">loaded</code></pre><pre><code class="language-julia">Turing.setadbackend(:reverse_diff);
Turing.turnprogress(false)</code></pre><pre><code class="language-none">┌ Info: [Turing]: global PROGRESS is set as false
└ @ Turing /Users/rob/.julia/packages/Turing/0dgDY/src/Turing.jl:81





false</code></pre><h3><a class="nav-anchor" id="snippet-2.8t-1" href="#snippet-2.8t-1">snippet 2.8t</a></h3><p>Define the data</p><pre><code class="language-julia">k = 6; n = 9;</code></pre><p>Define the model</p><pre><code class="language-julia">@model globe_toss(n, k) = begin
  theta ~ Beta(1, 1) # prior
  k ~ Binomial(n, theta) # model
  return k, theta
end;</code></pre><p>Compute the &quot;maximum<em>a</em>posteriori&quot; value</p><p>Set search bounds</p><pre><code class="language-julia">lb = [0.0]; ub = [1.0];</code></pre><p>Create (compile) the model</p><pre><code class="language-julia">model = globe_toss(n, k);</code></pre><p>Compute the maximum<em>a</em>posteriori</p><pre><code class="language-julia">result = maximum_a_posteriori(model, lb, ub)</code></pre><pre><code class="language-none">Results of Optimization Algorithm
 * Algorithm: Fminbox with L-BFGS
 * Starting Point: [0.5278344803167265]
 * Minimizer: [0.6666666666021692]
 * Minimum: 1.297811e+00
 * Iterations: 3
 * Convergence: true
   * |x - x&#39;| ≤ 0.0e+00: false 
     |x - x&#39;| = 4.62e-08 
   * |f(x) - f(x&#39;)| ≤ 0.0e+00 |f(x)|: false
     |f(x) - f(x&#39;)| = 3.35e-14 |f(x)|
   * |g(x)| ≤ 1.0e-08: true 
     |g(x)| = 1.87e-09 
   * Stopped by an increasing objective: false
   * Reached Maximum Number of Iterations: false
 * Objective Calls: 43
 * Gradient Calls: 43</code></pre><p>Use Turing mcmc</p><pre><code class="language-julia">chn = sample(model, NUTS(2000, 200, 0.65));</code></pre><pre><code class="language-none">┌ Info: [Turing] looking for good initial eps...
└ @ Turing /Users/rob/.julia/packages/Turing/0dgDY/src/samplers/support/hmc_core.jl:246
[NUTS{Turing.FluxTrackerAD,Union{}}] found initial ϵ: 0.4
└ @ Turing /Users/rob/.julia/packages/Turing/0dgDY/src/samplers/support/hmc_core.jl:291
┌ Info:  Adapted ϵ = 1.0169708384755447, std = [1.0]; 200 iterations is used for adaption.
└ @ Turing /Users/rob/.julia/packages/Turing/0dgDY/src/samplers/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 4.928556796000006;
  #lf / sample        = 0.002;
  #evals / sample     = 6.539;
  pre-cond. metric    = [1.0].</code></pre><p>Look at the generated draws (in chn)</p><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:2000
Thinning interval = 1
Chains = 1
Samples per chain = 2000

Empirical Posterior Estimates:
              Mean          SD       Naive SE       MCSE        ESS   
  lf_num  0.0020000000 0.089442719 0.0020000000 0.0020000000 2000.0000
 elapsed  0.0024642784 0.075235635 0.0016823199 0.0021980359 1171.5953
 epsilon  1.0548866415 0.461890119 0.0103281770 0.0271973584  288.4190
   theta  0.6320118370 0.139384359 0.0031167290 0.0049144284  804.4185
      lp -3.3031059558 0.785831841 0.0175717342 0.0220789561 1266.7828
eval_num  6.5390000000 3.424812940 0.0765811454 0.1028281653 1109.3013
  lf_eps  1.0548866415 0.461890119 0.0103281770 0.0271973584  288.4190

Quantiles:
              2.5%         25.0%         50.0%         75.0%         97.5%    
  lf_num  0.0000000000  0.0000000000  0.0000000000  0.000000000  0.00000000000
 elapsed  0.0001347157  0.0001382845  0.0001499945  0.000359588  0.00055348215
 epsilon  0.5855121691  1.0169708385  1.0169708385  1.016970838  1.76718835045
   theta  0.3244780718  0.5476709438  0.6403916720  0.734694037  0.87726562376
      lp -5.5307004970 -3.4356358751 -2.9975359347 -2.822909944 -2.77975955697
eval_num  4.0000000000  4.0000000000  4.0000000000 10.000000000 10.00000000000
  lf_eps  0.5855121691  1.0169708385  1.0169708385  1.016970838  1.76718835045</code></pre><p>Look at the mean and sd</p><pre><code class="language-julia">println(&quot;\ntheta = $(mean_and_std(chn[:theta][201:2000]))\n&quot;)</code></pre><pre><code class="language-none">theta = (0.6339059485766951, 0.13765016043159534)</code></pre><p>Fix the inclusion of adaptation samples</p><pre><code class="language-julia">chn2 = MCMCChain.Chains(chn.value[201:2000,:,:], names=chn.names)</code></pre><pre><code class="language-none">Object of type &quot;Chains{Float64}&quot;

Iterations = 1:1800
Thinning interval = 1
Chains = 1
Samples per chain = 1800

Union{Missing, Float64}[0.0 0.0245762 … 22.0 1.01697; 0.0 0.000412524 … 4.0 1.01697; … ; 0.0 0.000145242 … 4.0 1.01697; 0.0 0.000145184 … 4.0 1.01697]</code></pre><p>Look at the proper draws (in corrected chn2)</p><pre><code class="language-julia">describe(chn2)</code></pre><pre><code class="language-none">Iterations = 1:1800
Thinning interval = 1
Chains = 1
Samples per chain = 1800

Empirical Posterior Estimates:
              Mean                  SD                     Naive SE               MCSE         ESS   
  lf_num  0.00000000000 0.00000000000000000000000 0.000000000000000000000000 0.000000000000       NaN
 elapsed  0.00026535625 0.00064334605836867853230 0.000015163812017404300952 0.000019084184 1136.4284
 epsilon  1.01697083848 0.00000000000000066631893 0.000000000000000015705288 0.000000000000 1800.0000
   theta  0.63390594858 0.13765016043159533642992 0.003244445395753241690590 0.005260408830  684.7223
      lp -3.29160972548 0.75270133426860552638971 0.017741340588983106618670 0.020840661177 1304.4348
eval_num  6.41666666667 2.96388302012344873048733 0.069859392739098497004946 0.059765336315 1800.0000
  lf_eps  1.01697083848 0.00000000000000066631893 0.000000000000000015705288 0.000000000000 1800.0000

Quantiles:
              2.5%           25.0%        50.0%         75.0%          97.5%    
  lf_num  0.00000000000  0.00000000000  0.00000000  0.00000000000  0.00000000000
 elapsed  0.00013467397  0.00013860325  0.00014983  0.00035968725  0.00048772625
 epsilon  1.01697083848  1.01697083848  1.01697084  1.01697083848  1.01697083848
   theta  0.33090315595  0.54872730536  0.64026470  0.73821364480  0.87726562376
      lp -5.50759395812 -3.43606207112 -3.00188591 -2.82229156435 -2.77975601301
eval_num  4.00000000000  4.00000000000  4.00000000 10.00000000000 10.00000000000
  lf_eps  1.01697083848  1.01697083848  1.01697084  1.01697083848  1.01697083848</code></pre><p>Compute at hpd region</p><pre><code class="language-julia">bnds = MCMCChain.hpd(chn2[:, 4, :], alpha=0.06);</code></pre><p>analytical calculation</p><pre><code class="language-julia">w = 6; n = 9; x = 0:0.01:1
plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), fill=(0, .5,:orange), lab=&quot;Conjugate solution&quot;)</code></pre><p><img src="../output_28_0.svg" alt="svg"/></p><p>quadratic approximation</p><pre><code class="language-julia">plot!( x, pdf.(Normal( 0.67 , 0.16 ) , x ), lab=&quot;Normal approximation&quot;)</code></pre><p><img src="../output_30_0.svg" alt="svg"/></p><p>Turing Chain &amp;  89%hpd region boundaries</p><pre><code class="language-julia">density!(chn2[:theta], lab=&quot;Turing chain&quot;)
vline!([bnds[1]], line=:dash, lab=&quot;hpd lower bound&quot;)
vline!([bnds[2]], line=:dash, lab=&quot;hpd upper bound&quot;)</code></pre><pre><code class="language-none">MethodError: no method matching getindex(::Chains{Float64}, ::Symbol)
Closest candidates are:
  getindex(::Chains, ::Any, !Matched::Any, !Matched::Any) at /Users/rob/.julia/packages/MCMCChain/wl69W/src/chains.jl:110
  getindex(::Any, !Matched::AbstractTrees.ImplicitRootState) at /Users/rob/.julia/packages/AbstractTrees/z1wBY/src/AbstractTrees.jl:344



Stacktrace:

 [1] top-level scope at In[16]:1</code></pre><p>Show hpd region</p><pre><code class="language-julia">println(&quot;hpd bounds = $bnds\n&quot;)</code></pre><pre><code class="language-none">hpd bounds =       94% Lower 94% Upper
theta 0.3873379 0.9004367</code></pre><p>End of <code>clip_08t.jl</code></p><p><em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../clip-08s/"><span class="direction">Previous</span><span class="title">clip-08s</span></a><a class="next" href="../../03/clip-01/"><span class="direction">Next</span><span class="title">clip-01</span></a></footer></article></body></html>
