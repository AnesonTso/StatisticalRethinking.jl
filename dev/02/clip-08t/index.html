<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>clip-08t · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../clip-08m/">clip-08m</a></li><li><a class="toctext" href="../clip-08s/">clip-08s</a></li><li class="current"><a class="toctext" href>clip-08t</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07s/">clip-07s</a></li><li><a class="toctext" href="../../04/clip-38m/">clip-38m</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-43t/">clip-43t</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/clip-01s/">clip-01s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1t/">m8.1t</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 02</li><li><a href>clip-08t</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/docs/src/02/clip-08t.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>clip-08t</span><a class="fa fa-bars" href="#"></a></div></header><p>Load Julia packages (libraries) needed</p><pre><code class="language-julia">using StatisticalRethinking
using Optim, Turing, Flux.Tracker
gr(size=(600,300));

Turing.setadbackend(:reverse_diff)</code></pre><pre><code class="language-none">loaded


┌ Warning: Package Turing does not have CmdStan in its dependencies:
│ - If you have Turing checked out for development and have
│   added CmdStan as a dependency but haven&#39;t updated your primary
│   environment&#39;s manifest file, try `Pkg.resolve()`.
│ - Otherwise you may need to report an issue with Turing
│ Loading CmdStan into Turing from project dependency, future warnings for Turing are suppressed.
└ @ nothing nothing:840
WARNING: using CmdStan.Sample in module Turing conflicts with an existing identifier.





:reverse_diff</code></pre><h3><a class="nav-anchor" id="snippet-2.8t-1" href="#snippet-2.8t-1">snippet 2.8t</a></h3><p>Define the data</p><pre><code class="language-julia">k = 6; n = 9;</code></pre><p>Define the model</p><pre><code class="language-julia">@model globe_toss(n, k) = begin
  theta ~ Beta(1, 1) # prior
  k ~ Binomial(n, theta) # model
  return k, theta
end;</code></pre><p>Compute the &quot;maximum<em>a</em>posteriori&quot; value</p><p>Set search bounds</p><pre><code class="language-julia">lb = [0.0]; ub = [1.0];</code></pre><p>Create (compile) the model</p><pre><code class="language-julia">model = globe_toss(n, k);</code></pre><p>Compute the maximum<em>a</em>posteriori</p><pre><code class="language-julia">result = maximum_a_posteriori(model, lb, ub)</code></pre><pre><code class="language-none">Results of Optimization Algorithm
 * Algorithm: Fminbox with L-BFGS
 * Starting Point: [0.7074651788576896]
 * Minimizer: [0.6666666666346246]
 * Minimum: 1.297811e+00
 * Iterations: 3
 * Convergence: true
   * |x - x&#39;| ≤ 0.0e+00: false 
     |x - x&#39;| = 1.36e-08 
   * |f(x) - f(x&#39;)| ≤ 0.0e+00 |f(x)|: false
     |f(x) - f(x&#39;)| = 2.91e-15 |f(x)|
   * |g(x)| ≤ 1.0e-08: true 
     |g(x)| = 5.49e-10 
   * Stopped by an increasing objective: false
   * Reached Maximum Number of Iterations: false
 * Objective Calls: 40
 * Gradient Calls: 40</code></pre><p>Use Turing mcmc</p><pre><code class="language-julia">Turing.turnprogress(false)
chn = sample(model, NUTS(2000, 1000, 0.65));</code></pre><pre><code class="language-none">┌ Info: [Turing]: global PROGRESS is set as false
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/Turing.jl:81
┌ Info: [Turing] looking for good initial eps...
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/support/hmc_core.jl:246
[NUTS{Turing.FluxTrackerAD,Union{}}] found initial ϵ: 1.6
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/support/hmc_core.jl:291
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Warning: Numerical error has been found in gradients.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:154
┌ Warning: grad = [NaN]
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/core/ad.jl:155
┌ Info:  Adapted ϵ = 0.9578390791627754, std = [1.0]; 1000 iterations is used for adaption.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 5.0150662429999855;
  #lf / sample        = 0.003;
  #evals / sample     = 6.861;
  pre-cond. metric    = [1.0].</code></pre><p>Look at the generated draws (in chn)</p><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:2000
Thinning interval = 1
Chains = 1
Samples per chain = 2000

Empirical Posterior Estimates:
              Mean          SD       Naive SE       MCSE         ESS   
  lf_num  0.0030000000 0.134164079 0.0030000000 0.0030000000 2000.00000
 elapsed  0.0025075331 0.076118594 0.0017020635 0.0021953340 1202.20989
 epsilon  1.1224381138 1.169459120 0.0261499009 0.0493105061  562.45939
   theta  0.6360030739 0.141416742 0.0031621745 0.0051225094  762.14241
      lp -3.3190592140 0.784351311 0.0175386285 0.0269713545  845.69885
eval_num  6.8610000000 4.105375263 0.0917989816 0.1380253600  884.68354
  lf_eps  1.1224381138 1.169459120 0.0261499009 0.0493105061  562.45939

Quantiles:
              2.5%           25.0%         50.0%        75.0%          97.5%    
  lf_num  0.00000000000  0.00000000000  0.000000000  0.0000000000  0.00000000000
 elapsed  0.00015128197  0.00015763575  0.000171609  0.0004108415  0.00092276617
 epsilon  0.37088676482  0.95783907916  0.957839079  1.0079548635  2.57305557179
   theta  0.33883816330  0.54280720291  0.646171490  0.7438412205  0.87079519843
      lp -5.35598404924 -3.51435734171 -3.037441877 -2.8405070850 -2.78040346743
eval_num  4.00000000000  4.00000000000  4.000000000 10.0000000000 22.00000000000
  lf_eps  0.37088676482  0.95783907916  0.957839079  1.0079548635  2.57305557179</code></pre><p>Look at the mean and sd</p><pre><code class="language-julia">println(&quot;\ntheta = $(mean_and_std(chn[:theta][1001:2000]))\n&quot;)</code></pre><pre><code class="language-none">theta = (0.6451384410698796, 0.1396889134652362)</code></pre><p>Compute at hpd region</p><pre><code class="language-julia">bnds = MCMCChain.hpd(chn[:theta], alpha=0.06);</code></pre><p>analytical calculation</p><pre><code class="language-julia">w = 6; n = 9; x = 0:0.01:1
plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), fill=(0, .5,:orange), lab=&quot;Conjugate solution&quot;)</code></pre><p><img src="../output_23_0.svg" alt="svg"/></p><p>quadratic approximation</p><pre><code class="language-julia">plot!( x, pdf.(Normal( 0.67 , 0.16 ) , x ), lab=&quot;Normal approximation&quot;)</code></pre><p><img src="../output_25_0.svg" alt="svg"/></p><p>Turing Chain &amp;  89%hpd region boundaries</p><pre><code class="language-julia">density!(chn[:theta], lab=&quot;Turing chain&quot;)
vline!([bnds[1]], line=:dash, lab=&quot;hpd lower bound&quot;)
vline!([bnds[2]], line=:dash, lab=&quot;hpd upper bound&quot;)</code></pre><p><img src="../output_27_0.svg" alt="svg"/></p><p>Show hpd region</p><pre><code class="language-julia">println(&quot;hpd bounds = $bnds\n&quot;)</code></pre><pre><code class="language-none">hpd bounds = [0.38923, 0.899449]</code></pre><p>End of <code>clip_08t.jl</code></p><p><em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../clip-08s/"><span class="direction">Previous</span><span class="title">clip-08s</span></a><a class="next" href="../../03/clip-01/"><span class="direction">Next</span><span class="title">clip-01</span></a></footer></article></body></html>
