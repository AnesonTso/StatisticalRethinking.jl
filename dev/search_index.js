var documenterSearchIndex = {"docs":
[{"location":"intro/#StatisticalRethinking-1","page":"Home","title":"StatisticalRethinking","text":"","category":"section"},{"location":"intro/#Introduction-1","page":"Home","title":"Introduction","text":"","category":"section"},{"location":"intro/#","page":"Home","title":"Home","text":"This package contains Julia versions of selected code snippets and mcmc models contained in the R package \"rethinking\" associated with the book Statistical Rethinking by Richard McElreath.","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"In the book and associated R package rethinking, statistical models are defined as illustrated below:","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"flist <- alist(\n  height ~ dnorm( mu , sigma ) ,\n  mu <- a + b*weight ,\n  a ~ dnorm( 156 , 100 ) ,\n  b ~ dnorm( 0 , 10 ) ,\n  sigma ~ dunif( 0 , 50 )\n)","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"Posterior values can be approximated by","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"# Simulate quadratic approximation (for simpler models)\nm4.31 <- quad(flist, data=d2)","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"or generated using Stan by:","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"# Generate a Stan model and run a simulation\nm4.32 <- ulam(flist, data=d2)","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"The author of the book states: \"If that (the statistical model) doesn't make much sense, good. ... you're holding the right textbook, since this book teaches you how to read and write these mathematical descriptions\" (page 77).","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"The StatisticalRethinkingJulia Github organization is intended to allow experimenting with this learning process using four available mcmc options in Julia:","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"CmdStan\nDynamicHMC\nTuringLang\nMamba","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"At least one other package is available for mcmc in Julia:","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"Klara","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"Time constraints prevented this option to be in StatisticalRethinkingJulia.","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"A secondary objective of StatisticalRethinkingJulia is to compare definition and execution of a variety of models in the above four mcmc packages.","category":"page"},{"location":"intro/#","page":"Home","title":"Home","text":"Model scripts using Turing, Mamba, CmdStan or DynamicHMC can be found in TuringModels, StanModels, DynamicHMCModels and MambaModels, part of the StatisticalRethinkingJulia Github organization set of packages.","category":"page"},{"location":"layout/#Layout-of-the-package-1","page":"Layout","title":"Layout of the package","text":"","category":"section"},{"location":"layout/#","page":"Layout","title":"Layout","text":"Instead of having all snippets in a single file, the snippets are organized by chapter and grouped in clips by related snippets. E.g. chapter 0 of the R package has snippets 0.1 to 0.5. Those have been combined into 2 clips:","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"clip-01-03.jl - contains snippets 0.1 through 0.3\nclip-04-05.jl - contains snippets 0.4 and 0.5.","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"These 2 files are in scripts/00 and later on processed by Literate.jl to create 3 derived versions, e.g. from clip_01_03.jl in scripts/00:","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"clip-01-03.md - included in the documentation\nclip-01-03.ipynb - stored in the notebooks/chapter directory\nclip-01-03.jl - stored in the chapters/chapter directory","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"Occasionally lines in scripts are suppressed when Literate processes input source files, e.g. in Turing scripts the statement #nb Turing.turnprogress(false); is only inserted in the generated notebook but not in the corresponding chapter .jl script. Similarly #src ... will only be included in the .jl scripts in the chapters subdirectories.","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"A single snippet clip will be referred to as 03/clip-02.jl. ","category":"page"},{"location":"layout/#","page":"Layout","title":"Layout","text":"Models with names such as 08/m8.1t.jl, 04/m4.1s.jl, 04/m4.4m.jl and 04/m4.5d.jl generate mcmc samples using Turing.jl, CmdStan.jl, Mamba.jl or DynamicHMC.jl respectively. In some cases the results of the mcmc chains have been stored and retrieved (or regenerated if missing) in other clips, e.g. 04/clip-30s.jl.","category":"page"},{"location":"versions/#Versions-and-notes-1","page":"Versions","title":"Versions & notes","text":"","category":"section"},{"location":"versions/#","page":"Versions","title":"Versions","text":"Developing rethinking must have been an on-going process over several years, StatisticalRethinkinh.jl will likely follow a similar path.","category":"page"},{"location":"versions/#","page":"Versions","title":"Versions","text":"The initial version (v1) of StatisticalRethinking is really just a first attempt to capture the models and show ways of setting up those models, execute the models and post-process the results using Julia.\nAs mentioned above, a second objective of v1 is to experiment and compare the four selected mcmc options in Julia in terms of results, performance, ease of expressing models, etc.\nThe R package rethinking, in the experimental branch on Github, contains 2 functions quap and ulam (previously called map and map2stan) which are not in v1 of Statisticalrethinking.jl. It is my intention to study those and possibly include quap or ulam (or both) in a future of Statisticalrethinking.\nSeveral other interesting approaches that could become a good basis for such an endeavour are being explored in Julia, e.g. Soss.jl and Omega.jl.\nMany other R functions such as precis(), link(), shade(), etc. are not in v1, although some very early versions are being tested. Expect significant refactoring of those in future versions.\nThe Mamba examples should really use @everywhere using Mamba in stead of using Mamba. This was done to get around a limitation in Literate.jl to test the notebooks when running in distributed mode. \nIn the src directory of all packages is a file scriptentry.jl which defines an object script_dict which is used to control the generation of documentation, notebooks and .jl scripts in chapters and testing of the notebooks. See ?ScriptEntry or enter e.g. script_dict[\"02\"] in the REPL. In the model packages this file is suffixed by an indication of the used mcmc option. e.g. script_dict_d in DynamicHMCModels.\nA utility function, generate() is part of each package to regenerate notebooks and chapter scripts, please see ?generate. Again, e.g. generate_t in TuringModels generates all model notebooks and chapter scripts for Turing models.\nIn a similar fashion, borrowed from DynamicHMCExamples I define several variations on rel_path(). By itself, rel_path() points at the scr directory of StatisticalRethinking.jl and e.g. rel_path_s() points to the src directory of StanModels. The rel_path() version is typically used to read in data files. All others are used to locate directorres to read from or store generated files into.","category":"page"},{"location":"acknowledgements/#Acknowledgements-1","page":"Acknowledgements","title":"Acknowledgements","text":"","category":"section"},{"location":"acknowledgements/#Acknowledgements-2","page":"Acknowledgements","title":"Acknowledgements","text":"","category":"section"},{"location":"acknowledgements/#","page":"Acknowledgements","title":"Acknowledgements","text":"Richard Torkar has taken the lead in developing the Turing versions of the models in chapter 8 and subsequent chapters. ","category":"page"},{"location":"acknowledgements/#","page":"Acknowledgements","title":"Acknowledgements","text":"Tamas Papp has been very helpful during the development of the DynamicHMC versions of the models.","category":"page"},{"location":"acknowledgements/#","page":"Acknowledgements","title":"Acknowledgements","text":"The TuringLang team and #turing contributors on Slack have been extremely helpful! The Turing examples by Cameron Pfiffer are followed closely in several example scripts.","category":"page"},{"location":"acknowledgements/#","page":"Acknowledgements","title":"Acknowledgements","text":"The  documentation has been generated using Literate.jl and Documenter.jl based on several ideas demonstrated by Tamas Papp in  DynamicHMCExamples.jl.","category":"page"},{"location":"references/#References-1","page":"References","title":"References","text":"","category":"section"},{"location":"references/#","page":"References","title":"References","text":"There is no shortage of good books on Bayesian statistics. A few of my favorites are:","category":"page"},{"location":"references/#","page":"References","title":"References","text":"Bolstad: Introduction to Bayesian statistics\nBolstad: Understanding Computational Bayesian Statistics\nGelman, Hill: Data Analysis using regression and multileve,/hierachical models\nMcElreath: Statistical Rethinking\nKruschke: Doing Bayesian Data Analysis\nLee, Wagenmakers: Bayesian Cognitive Modeling\nGelman, Carlin, and others: Bayesian Data Analysis","category":"page"},{"location":"references/#","page":"References","title":"References","text":"and a great read (and implementation in DynamicHMC.jl):","category":"page"},{"location":"references/#","page":"References","title":"References","text":"Betancourt: A Conceptual Introduction to Hamiltonian Monte Carlo","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/00/clip-01-03.jl\"","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"using StatisticalRethinking","category":"page"},{"location":"00/clip-01-03/#snippet-0.1-1","page":"clip-01-03","title":"snippet 0.1","text":"","category":"section"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"println( \"All models are wrong, but some are useful.\" );","category":"page"},{"location":"00/clip-01-03/#snippet-0.2-1","page":"clip-01-03","title":"snippet 0.2","text":"","category":"section"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"This is a StepRange, not a vector","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"x = 1:3","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"Below still preserves the StepRange","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"x = x*10","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"Broadcast log to steprange elements in x, this returms a vector! Notice the log.(x) notation.","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"x = log.(x)","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"We can sum the vector x","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"x = sum(x)","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"Etc.","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"x = exp(x)\nx = x*10\nx = log(x)\nx = sum(x)\nx = exp(x)","category":"page"},{"location":"00/clip-01-03/#snippet-0.3-1","page":"clip-01-03","title":"snippet 0.3","text":"","category":"section"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"[log(0.01^200) 200 * log(0.01)]","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"End of 00/clip-01-03.jl","category":"page"},{"location":"00/clip-01-03/#","page":"clip-01-03","title":"clip-01-03","text":"This page was generated using Literate.jl.","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/00/clip-04-05.jl\"","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"00/clip-04-05/#snippet-0.5-is-replaced-by-below-using-StatisticalRethinking.-1","page":"clip-04-05","title":"snippet 0.5 is replaced by below using StatisticalRethinking.","text":"","category":"section"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"using StatisticalRethinking, GLM\ngr(size=(500, 500));","category":"page"},{"location":"00/clip-04-05/#snippet-0.4-1","page":"clip-04-05","title":"snippet 0.4","text":"","category":"section"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"Below dataset(...) provides access to often used R datasets. If this is not a common R dataset, see the chapter 4 snippets.","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"cars = dataset(\"datasets\", \"cars\");\nfirst(cars, 5)","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"Fit a linear regression of distance on speed","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"m = lm(@formula(Dist ~ Speed), cars)","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"estimated coefficients from the model","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"coef(m)","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"Plot residuals against speed","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"scatter( cars[:Speed], residuals(m), xlab=\"Speed\",\nylab=\"Model residual values\", lab=\"Model residuals\")","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"End of 00/clip-04-05.jl","category":"page"},{"location":"00/clip-04-05/#","page":"clip-04-05","title":"clip-04-05","text":"This page was generated using Literate.jl.","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/02/clip-01-02.jl\"","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"using StatisticalRethinking","category":"page"},{"location":"02/clip-01-02/#snippet-2.1-1","page":"clip-01-02","title":"snippet 2.1","text":"","category":"section"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"ways  = [0, 3, 8, 9, 0];","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"ways/sum(ways)","category":"page"},{"location":"02/clip-01-02/#snippet-2.2-1","page":"clip-01-02","title":"snippet 2.2","text":"","category":"section"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"Create a distribution with n = 9 (e.g. tosses) and p = 0.5.","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"d = Binomial(9, 0.5)","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"Probability density for 6 waters holding n = 9 and p = 0.5.","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"pdf(d, 6)","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"End of 02/clip-01-02.jl","category":"page"},{"location":"02/clip-01-02/#","page":"clip-01-02","title":"clip-01-02","text":"This page was generated using Literate.jl.","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/02/clip-03-05.jl\"","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"using StatisticalRethinking\ngr(size=(600,300));","category":"page"},{"location":"02/clip-03-05/#snippet-2.3-1","page":"clip-03-05","title":"snippet 2.3","text":"","category":"section"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Define a grid","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"N = 20\np_grid = range( 0 , stop=1 , length=N )","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Define the (uniform) prior","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"prior = ones( 20 );","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Compute likelihood at each value in grid","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"likelihood = [pdf(Binomial(9, p), 6) for p in p_grid]\nlikelihood[1:5]","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Compute product of likelihood and prior","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"unstd_posterior = likelihood .* prior;","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"Standardize the posterior, so it sums to 1","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"posterior = unstd_posterior  ./ sum(unstd_posterior);","category":"page"},{"location":"02/clip-03-05/#snippet-2.4-1","page":"clip-03-05","title":"snippet 2.4","text":"","category":"section"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"p1 = plot( p_grid , posterior ,\n    xlab=\"probability of water\" , ylab=\"posterior probability\",\n    lab = \"interpolated\", title=\"20 points\" )\np2 = scatter!( p1, p_grid , posterior, lab=\"computed\" )","category":"page"},{"location":"02/clip-03-05/#snippet-2.5-1","page":"clip-03-05","title":"snippet 2.5","text":"","category":"section"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"prior1 = [p < 0.5 ? 0 : 1 for p in p_grid]\nprior2 = [exp( -5*abs( p - 0.5 ) ) for p in p_grid]\n\np3 = plot(p_grid, prior1,\n  xlab=\"probability of water\" , ylab=\"posterior probability\",\n  lab = \"semi_uniform\", title=\"Other priors\" )\nscatter!(p3, p_grid, prior1, lab = \"semi_uniform grid point\")\nplot!(p3, p_grid, prior2,  lab = \"double_exponential\" )\nscatter!(p3, p_grid, prior2,  lab = \"double_exponential grid point\" )","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"End of 02/clip-03-05.jl","category":"page"},{"location":"02/clip-03-05/#","page":"clip-03-05","title":"clip-03-05","text":"This page was generated using Literate.jl.","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/02/clip-06-07.jl\"","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"using StatisticalRethinking, Optim\ngr(size=(600,600));","category":"page"},{"location":"02/clip-06-07/#snippet-2.6-1","page":"clip-06-07","title":"snippet 2.6","text":"","category":"section"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Grid of 1001 steps","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"p_grid = range(0, step=0.001, stop=1);","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"all priors = 1.0","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"prior = ones(length(p_grid));","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Binomial pdf","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"likelihood = [pdf(Binomial(9, p), 6) for p in p_grid];","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"As Uniform prior has been used, unstandardized posterior is equal to likelihood","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"posterior = likelihood .* prior;","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Scale posterior such that they become probabilities","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"posterior = posterior / sum(posterior);","category":"page"},{"location":"02/clip-06-07/#snippet-3.3-1","page":"clip-06-07","title":"snippet 3.3","text":"","category":"section"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Sample using the computed posterior values as weights","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"N = 10000\nsamples = sample(p_grid, Weights(posterior), N);","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"In StatisticalRethinkingJulia samples will always be stored in an MCMCChains.Chains object.","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"chn = MCMCChains.Chains(reshape(samples, N, 1, 1), [\"toss\"]);","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Describe the chain","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"describe(chn)","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Plot the chain","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"plot(chn)","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Compute the MAP (maximumaposteriori) estimate","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"x0 = [0.5]\nlower = [0.0]\nupper = [1.0]\n\nfunction loglik(x)\n  ll = 0.0\n  ll += log.(pdf.(Beta(1, 1), x[1]))\n  ll += sum(log.(pdf.(Binomial(9, x[1]), repeat([6], 1))))\n  -ll\nend\n\n(qmap, opt) = quap(loglik, x0, lower, upper)","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Show optimization results","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"opt","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"Fit quadratic approcimation","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"quapfit = [qmap[1], std(samples, mean=qmap[1])]\n\np = Vector{Plots.Plot{Plots.GRBackend}}(undef, 4)\np[1] = scatter(1:length(p_grid), samples, markersize = 2, ylim=(0.0, 1.3), lab=\"Draws\")","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"analytical calculation","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"w = 6\nn = 9\nx = 0:0.01:1\np[2] = plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")\ndensity!(p[2], samples, lab=\"Sample density\")","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"quadratic approximation","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"p[3] = plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")\nplot!( p[3], x, pdf.(Normal( quapfit[1], quapfit[2] ) , x ), lab=\"Quap approximation\")","category":"page"},{"location":"02/clip-06-07/#snippet-2.7-1","page":"clip-06-07","title":"snippet 2.7","text":"","category":"section"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"w = 6; n = 9; x = 0:0.01:1\np[4] = plot( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")\nplot!(p[4], x, pdf.(Normal( 0.67 , 0.16 ) , x ), lab=\"Normal approximation\")\nplot(p..., layout=(2, 2))","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"End of 02/clip-06-07.jl","category":"page"},{"location":"02/clip-06-07/#","page":"clip-06-07","title":"clip-06-07","text":"This page was generated using Literate.jl.","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/02/clip-08.jl\"","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"using StatisticalRethinking","category":"page"},{"location":"02/clip-08/#snippet-2.8-1","page":"clip-08","title":"snippet 2.8","text":"","category":"section"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Simple Metropolis algorithm","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"n_samples = 10000\na3d = ones(n_samples,1,1)\nw = 6; l = 3; n = w +l\np = [0.5]\nfor i in 2:n_samples\n  p_new = rand(Normal(p[i-1], 0.1), 1)[1]\n  if  p_new < 0\n    p_new = abs(p_new)\n  end\n  if p_new > 1\n    p_new = 2 - p_new\n  end\n  q0 = pdf(Binomial(n, p[i-1]), w)\n  q1 = pdf(Binomial(n, p_new), w)\n  append!(p, [rand(Uniform(0, 1), 1)[1] < q1/q0 ? p_new : p[i-1]])\nend","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Create an MCMCChains.Chains object. This Chains object has length(p) samples, one varable and a single chain.","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"a3d[:, 1, 1] = p\nchns = MCMCChains.Chains(a3d, [\"toss\"])","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Describe the chain","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"describe(chns)","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Plot the chain","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"plot(chns)","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"Show density and computed conjugate solution","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"w = 6; n = 9; x = 0:0.01:1\ndensity(chns, lab=\"Samples\")\nplot!( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"End of 02/clip-08.jl","category":"page"},{"location":"02/clip-08/#","page":"clip-08","title":"clip-08","text":"This page was generated using Literate.jl.","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/02/m2.1s.jl\"","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"02\")\ncd(ProjDir)","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Define the Stan language model","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"binomialstanmodel = \"\n// Inferring a Rate\ndata {\n  int N;\n  int<lower=0> k[N];\n  int<lower=1> n[N];\n}\nparameters {\n  real<lower=0,upper=1> theta;\n  real<lower=0,upper=1> thetaprior;\n}\nmodel {\n  // Prior Distribution for Rate Theta\n  theta ~ beta(1, 1);\n  thetaprior ~ beta(1, 1);\n\n  // Observed Counts\n  k ~ binomial(n, theta);\n}\n\";","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"stanmodel = Stanmodel(name=\"binomial\", monitors = [\"theta\"], model=binomialstanmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Use 16 observations","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"N2 = 15\nd = Binomial(9, 0.66)\nn2 = Int.(9 * ones(Int, N2));","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Show first 5 (generated) observations","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"k2 = rand(d, N2);\nk2[1:min(5, N2)]","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Input data for cmdstan","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"binomialdata = Dict(\"N\" => length(n2), \"n\" => n2, \"k\" => k2);","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Sample using cmdstan","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"rc, chn, cnames = stan(stanmodel, binomialdata, ProjDir, diagnostics=false,\n  CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Describe the draws","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"describe(chn)","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Allocate array of Normal fits","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"fits = Vector{Normal{Float64}}(undef, 4)\nfor i in 1:4\n  fits[i] = fit_mle(Normal, convert.(Float64, chn.value[:, 1, i]))\n  println(fits[i])\nend","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Plot the 4 chains","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"mu_avg = sum([fits[i].μ for i in 1:4]) / 4.0;\nsigma_avg = sum([fits[i].σ for i in 1:4]) / 4.0;\n\nif rc == 0\n  p = Vector{Plots.Plot{Plots.GRBackend}}(undef, 4)\n  x = 0:0.001:1\n  for i in 1:4\n    vals = convert.(Float64, chn.value[:, 1, i])\n    μ = round(fits[i].μ, digits=2)\n    σ = round(fits[i].σ, digits=2)\n    p[i] = density(vals, lab=\"Chain $i density\",\n       xlim=(0.45, 1.0), title=\"$(N2) data points\")\n    plot!(p[i], x, pdf.(Normal(fits[i].μ, fits[i].σ), x), lab=\"Fitted Normal($μ, $σ)\")\n  end\n  plot(p..., layout=(4, 1))\nend","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Show the hpd region","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"hpd(chn, alpha=0.055)","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Compute the hpd bounds for plotting","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"d, p, c = size(chn);\ntheta = convert(Vector{Float64}, reshape(chn.value, (d*p*c)));\nbnds = quantile(theta, [0.045, 0.945])","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Show hpd region","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"println(\"hpd bounds = $bnds\\n\")","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"quadratic approximation","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Compute MAP, compare with CmndStan & MLE","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"tmp = convert(Array{Float64,3}, chn.value)\ndraws = reshape(tmp, (size(tmp, 1)*size(tmp, 3)),)","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Compute MAP","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"using Optim\n\nx0 = [0.5]\nlower = [0.2]\nupper = [1.0]\n\ninner_optimizer = GradientDescent()\n\nfunction loglik(x)\n  ll = 0.0\n  ll += log.(pdf.(Beta(1, 1), x[1]))\n  ll += sum(log.(pdf.(Binomial(9, x[1]), k2)))\n  -ll\nend\n\nres = optimize(loglik, lower, upper, x0, Fminbox(inner_optimizer))","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Summarize mean and sd estimates","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"CmdStan mean and sd:","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"[mean(chn.value), std(chn.value)]","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"MAP estimate and associated sd:","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"[Optim.minimizer(res)[1], std(draws, mean=mean(chn.value))]","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"MLE of mean and sd:","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"[mu_avg, sigma_avg]","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"Turing Chain &  89% hpd region boundaries","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"plot( x, pdf.(Normal( mu_avg , sigma_avg  ) , x ),\nxlim=(0.0, 1.2), lab=\"Normal approximation using MLE\")\nplot!( x, pdf.(Normal( Optim.minimizer(res)[1] , std(draws, mean=mean(chn.value))) , x),\nlab=\"Normal approximation using MAP\")\ndensity!(draws, lab=\"CmdStan chain\")\nvline!([bnds[1]], line=:dash, lab=\"hpd lower bound\")\nvline!([bnds[2]], line=:dash, lab=\"hpd upper bound\")","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"End of 02/clip_08s.jl","category":"page"},{"location":"02/m2.1s/#","page":"m2.1s","title":"m2.1s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-01.jl\"","category":"page"},{"location":"03/clip-01/#clip-01.jl-1","page":"clip-01","title":"clip-01.jl","text":"","category":"section"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"using StatisticalRethinking","category":"page"},{"location":"03/clip-01/#snippet-3.1-1","page":"clip-01","title":"snippet 3.1","text":"","category":"section"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"PrPV = 0.95\nPrPM = 0.01\nPrV = 0.001\nPrP = PrPV*PrV + PrPM*(1-PrV)\nPrVP = PrPV*PrV / PrP","category":"page"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"End of 03/clip-01.jl","category":"page"},{"location":"03/clip-01/#","page":"clip-01","title":"clip-01","text":"This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-02-05.jl\"","category":"page"},{"location":"03/clip-02-05/#clip-02-05.jl-1","page":"clip-02-05","title":"clip-02-05.jl","text":"","category":"section"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"using StatisticalRethinking, Optim\ngr(size=(600,300));","category":"page"},{"location":"03/clip-02-05/#snippet-3.2-1","page":"clip-02-05","title":"snippet 3.2","text":"","category":"section"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"p_grid = range(0, step=0.001, stop=1)\nprior = ones(length(p_grid))\nlikelihood = [pdf(Binomial(9, p), 6) for p in p_grid]\nposterior = likelihood .* prior\nposterior = posterior / sum(posterior)\nsamples = sample(p_grid, Weights(posterior), length(p_grid));\nsamples[1:5]","category":"page"},{"location":"03/clip-02-05/#snippet-3.3-1","page":"clip-02-05","title":"snippet 3.3","text":"","category":"section"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Draw 10000 samples from this posterior distribution","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"N = 10000\nsamples = sample(p_grid, Weights(posterior), N);","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"In StatisticalRethinkingJulia samples will always be stored in an MCMCChains.Chains object.","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"chn = MCMCChains.Chains(reshape(samples, N, 1, 1), [\"toss\"]);","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Describe the chain","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"describe(chn)","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Plot the chain","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"plot(chn)","category":"page"},{"location":"03/clip-02-05/#snippet-3.4-1","page":"clip-02-05","title":"snippet 3.4","text":"","category":"section"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Create a vector to hold the plots so we can later combine them","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"p = Vector{Plots.Plot{Plots.GRBackend}}(undef, 2)\np[1] = scatter(1:N, samples, markersize = 2, ylim=(0.0, 1.3), lab=\"Draws\")","category":"page"},{"location":"03/clip-02-05/#snippet-3.5-1","page":"clip-02-05","title":"snippet 3.5","text":"","category":"section"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Analytical calculation","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"w = 6\nn = 9\nx = 0:0.01:1\np[2] = density(samples, ylim=(0.0, 5.0), lab=\"Sample density\")\np[2] = plot!( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"Add quadratic approximation","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"plot(p..., layout=(1, 2))","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"End of 03/clip-02-05.jl","category":"page"},{"location":"03/clip-02-05/#","page":"clip-02-05","title":"clip-02-05","text":"This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-05s.jl\"","category":"page"},{"location":"03/clip-05s/#clip-05s.jl-1","page":"clip-05s","title":"clip-05s.jl","text":"","category":"section"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,800));","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"03\")\ncd(ProjDir)","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Define the Stan language model","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"binomialstanmodel = \"\n// Inferring a Rate\ndata {\n  int N;\n  int<lower=0> k[N];\n  int<lower=1> n[N];\n}\nparameters {\n  real<lower=0,upper=1> theta;\n  real<lower=0,upper=1> thetaprior;\n}\nmodel {\n  // Prior Distribution for Rate Theta\n  theta ~ beta(1, 1);\n  thetaprior ~ beta(1, 1);\n\n  // Observed Counts\n  k ~ binomial(n, theta);\n}\n\";","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"stanmodel = Stanmodel(name=\"binomial\", monitors = [\"theta\"], model=binomialstanmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Use 16 observations","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"N2 = 4^2\nd = Binomial(9, 0.66)\nn2 = Int.(9 * ones(Int, N2))\nk2 = rand(d, N2);","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Input data for cmdstan","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"binomialdata = Dict(\"N\" => length(n2), \"n\" => n2, \"k\" => k2);","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Sample using cmdstan","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"rc, chn, cnames = stan(stanmodel, binomialdata, ProjDir, diagnostics=false,\n  CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Describe the draws","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"describe(chn)","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"Plot the 4 chains","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"if rc == 0\n  plot(chn)\nend","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"End of 03/clip-05s.jl","category":"page"},{"location":"03/clip-05s/#","page":"clip-05s","title":"clip-05s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-06-10.jl\"","category":"page"},{"location":"03/clip-06-10/#clip-06-10.jl-1","page":"clip-06-10","title":"clip-06-10.jl","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"using StatisticalRethinking, Optim\ngr(size=(600,300));","category":"page"},{"location":"03/clip-06-10/#snippet-3.2-1","page":"clip-06-10","title":"snippet 3.2","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"p_grid = range(0, step=0.001, stop=1)\nprior = ones(length(p_grid))\nlikelihood = [pdf(Binomial(9, p), 6) for p in p_grid]\nposterior = likelihood .* prior\nposterior = posterior / sum(posterior)","category":"page"},{"location":"03/clip-06-10/#snippet-3.3-1","page":"clip-06-10","title":"snippet 3.3","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"Draw 10000 samples from this posterior distribution","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"N = 10000\nsamples = sample(p_grid, Weights(posterior), N);","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"In StatisticalRethinkingJulia samples will always be stored in an MCMCChains.Chains object.","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"chn = MCMCChains.Chains(reshape(samples, N, 1, 1), [\"toss\"]);","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"Describe the chain","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"describe(chn)","category":"page"},{"location":"03/clip-06-10/#snippet-3.6-1","page":"clip-06-10","title":"snippet 3.6","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"v = 0.0\nfor i in 1:length(p_grid)\n  global v\n  if p_grid[i] < 0.5\n    v += posterior[i]\n  end\nend\nv","category":"page"},{"location":"03/clip-06-10/#snippet-3.7-1","page":"clip-06-10","title":"snippet 3.7","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"mapreduce(p -> p < 0.5 ? 1 : 0, +, samples) / N   |> display","category":"page"},{"location":"03/clip-06-10/#snippet-3.8-1","page":"clip-06-10","title":"snippet 3.8","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"mapreduce(p -> (p > 0.5 && p < 0.75) ? 1 : 0, +, samples) / N   |> display","category":"page"},{"location":"03/clip-06-10/#snippet-3.9-1","page":"clip-06-10","title":"snippet 3.9","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"quantile(samples, 0.8)","category":"page"},{"location":"03/clip-06-10/#snippet-3.10-1","page":"clip-06-10","title":"snippet 3.10","text":"","category":"section"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"quantile(samples, [0.1, 0.9])","category":"page"},{"location":"03/clip-06-10/#","page":"clip-06-10","title":"clip-06-10","text":"End of 03/clip-06-10.jl#- This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-11-16.jl\"","category":"page"},{"location":"03/clip-11-16/#clip-11-16.jl-1","page":"clip-11-16","title":"clip-11-16.jl","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"using StatisticalRethinking, Optim\ngr(size=(600,300));","category":"page"},{"location":"03/clip-11-16/#snippet-3.11-1","page":"clip-11-16","title":"snippet 3.11","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"p_grid = range(0, step=0.001, stop=1)\nprior = ones(length(p_grid))\nlikelihood = [pdf(Binomial(3, p), 3) for p in p_grid]\nposterior = likelihood .* prior\nposterior = posterior / sum(posterior)","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"Draw 10000 samples from this posterior distribution","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"N = 10000\nsamples = sample(p_grid, Weights(posterior), N);","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"In StatisticalRethinkingJulia samples will always be stored in an MCMCChains.Chains object.","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"chn = MCMCChains.Chains(reshape(samples, N, 1, 1), [\"toss\"]);","category":"page"},{"location":"03/clip-11-16/#snippet-3.12-1","page":"clip-11-16","title":"snippet 3.12","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"describe(chn)","category":"page"},{"location":"03/clip-11-16/#snippet-3.13-1","page":"clip-11-16","title":"snippet 3.13","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"MCMCChains.hpd(chn, alpha=0.5)","category":"page"},{"location":"03/clip-11-16/#snippet-3.14-1","page":"clip-11-16","title":"snippet 3.14","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"mode(samples)","category":"page"},{"location":"03/clip-11-16/#snippet-3.15-1","page":"clip-11-16","title":"snippet 3.15","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"mean(samples)","category":"page"},{"location":"03/clip-11-16/#snippet-3.16-1","page":"clip-11-16","title":"snippet 3.16","text":"","category":"section"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"median(samples)","category":"page"},{"location":"03/clip-11-16/#","page":"clip-11-16","title":"clip-11-16","text":"End of 03/clip-11-16.jl#- This page was generated using Literate.jl.","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/03/clip-17s.jl\"","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Load Julia packages (libraries) needed","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"03\")\ncd(ProjDir)","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Define the Stan language model","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"binomialstanmodel = \"\n// Inferring a Rate\ndata {\n  int N;\n  int<lower=0> k[N];\n  int<lower=1> n[N];\n}\nparameters {\n  real<lower=0,upper=1> theta;\n  real<lower=0,upper=1> thetaprior;\n}\nmodel {\n  // Prior Distribution for Rate Theta\n  theta ~ beta(1, 1);\n  thetaprior ~ beta(1, 1);\n\n  // Observed Counts\n  k ~ binomial(n, theta);\n}\n\";","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"stanmodel = Stanmodel(name=\"binomial\", monitors = [\"theta\"], model=binomialstanmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Use 4 observations","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"N2 = 4\nn2 = Int.(9 * ones(Int, N2))\nk2 = [6, 5, 7, 6]","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Input data for cmdstan","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"binomialdata = Dict(\"N\" => length(n2), \"n\" => n2, \"k\" => k2);","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Sample using cmdstan","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"rc, chn, cnames = stan(stanmodel, binomialdata, ProjDir, diagnostics=false,\n  CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Describe the draws","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"describe(chn)","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Look at area of hpd","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"MCMCChains.hpd(chn)","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"Plot the 4 chains","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"if rc == 0\n  mixeddensity(chn, xlab=\"height [cm]\", ylab=\"density\")\n  bnds = hpd(chn[:,1,1])\n  vline!([bnds[:lower]], line=:dash)\n  vline!([bnds[:upper]], line=:dash)\nend","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"End of clip-06-16s.jl","category":"page"},{"location":"03/clip-17s/#","page":"clip-17s","title":"clip-17s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/m4.1s/#","page":"m4.1s","title":"m4.1s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/m4.1s.jl\"","category":"page"},{"location":"04/m4.1s/#","page":"m4.1s","title":"m4.1s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));\n\nProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)\n\nhowell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);\n\ndf2 = filter(row -> row[:age] >= 18, df)\nfirst(df2, 5)\n\nheightsmodel = \"\n// Inferring a Rate\ndata {\n  int N;\n  real<lower=0> h[N];\n}\nparameters {\n  real<lower=0> sigma;\n  real<lower=0,upper=250> mu;\n}\nmodel {\n  // Priors for mu and sigma\n  mu ~ normal(178, 20);\n  sigma ~ uniform( 0 , 50 );\n\n  // Observed heights\n  h ~ normal(mu, sigma);\n}\n\";\n\nstanmodel = Stanmodel(name=\"heights\", monitors = [\"mu\", \"sigma\"],model=heightsmodel,\n  output_format=:mcmcchains);\n\nheightsdata = Dict(\"N\" => length(df2[:height]), \"h\" => df2[:height]);\n\nrc, chn, cnames = stan(stanmodel, heightsdata, ProjDir, diagnostics=false,\n  CmdStanDir=CMDSTAN_HOME);\n\ndescribe(chn)\n\nserialize(\"m4.1s.jls\", chn)\nchn2 = deserialize(\"m4.1s.jls\")\n\ndescribe(chn2)","category":"page"},{"location":"04/m4.1s/#","page":"m4.1s","title":"m4.1s","text":"end of m4.1s#- This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-01-06.jl\"","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"using StatisticalRethinking\ngr(size=(600,300));","category":"page"},{"location":"04/clip-01-06/#snippet-4.1-1","page":"clip-01-06","title":"snippet 4.1","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"No attempt has been made to condense this too fewer lines of code","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"noofsteps = 20;\nnoofwalks = 15;\npos = Array{Float64, 2}(rand(Uniform(-1, 1), noofsteps, noofwalks));\npos[1, :] = zeros(noofwalks);\ncsum = cumsum(pos, dims=1);","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"f = Plots.font(\"DejaVu Sans\", 6)\nmx = minimum(csum) * 0.9","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Plot and annotate the random walks","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"p1 = plot(csum, leg=false, title=\"Random walks ($(noofwalks))\")\nplot!(p1, csum[:, Int(floor(noofwalks/2))], leg=false, title=\"Random walks ($(noofwalks))\", color=:black)\nplot!(p1, [5], seriestype=\"vline\")\nannotate!(5, mx, text(\"step 4\", f, :left))\nplot!(p1, [9], seriestype=\"vline\")\nannotate!(9, mx, text(\"step 8\", f, :left))\nplot!(p1, [17], seriestype=\"vline\")\nannotate!(17, mx, text(\"step 16\", f, :left))","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Generate 3 plots of densities at 3 different step numbers (4, 8 and 16)","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"p2 = Vector{Plots.Plot{Plots.GRBackend}}(undef, 3);\nplt = 1\nfor step in [4, 8, 16]\n  indx = step + 1 # We aadded the first line of zeros\n  global plt\n  fit = fit_mle(Normal, csum[indx, :])\n  x = (fit.μ-4*fit.σ):0.01:(fit.μ+4*fit.σ)\n  p2[plt] = density(csum[indx, :], legend=false, title=\"$(step) steps\")\n  plot!( p2[plt], x, pdf.(Normal( fit.μ , fit.σ ) , x ), fill=(0, .5,:orange))\n  plt += 1\nend\np3 = plot(p2..., layout=(1, 3))\nplot(p1, p3, layout=(2,1))","category":"page"},{"location":"04/clip-01-06/#snippet-4.2-1","page":"clip-01-06","title":"snippet 4.2","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"prod(1 .+ rand(Uniform(0, 0.1), 10))","category":"page"},{"location":"04/clip-01-06/#snippet-4.3-1","page":"clip-01-06","title":"snippet 4.3","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"growth = [prod(1 .+ rand(Uniform(0, 0.1), 10)) for i in 1:10000];\nfit = fit_mle(Normal, growth)\nplot(Normal(fit.μ , fit.σ ), fill=(0, .5,:orange), lab=\"Normal distribution\")\ndensity!(growth, lab=\"'sample' distribution\")","category":"page"},{"location":"04/clip-01-06/#snippet-4.4-1","page":"clip-01-06","title":"snippet 4.4","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"big = [prod(1 .+ rand(Uniform(0, 0.5), 12)) for i in 1:10000];\nsmall = [prod(1 .+ rand(Uniform(0, 0.01), 12)) for i in 1:10000];\nfitb = fit_mle(Normal, big)\nfits = fit_mle(Normal, small)\np1 = plot(Normal(fitb.μ , fitb.σ ), lab=\"Big normal distribution\", fill=(0, .5,:orange))\np2 = plot(Normal(fits.μ , fits.σ ), lab=\"Small normal distribution\", fill=(0, .5,:orange))\ndensity!(p1, big, lab=\"'big' distribution\")\ndensity!(p2, small, lab=\"'small' distribution\")\nplot(p1, p2, layout=(1, 2))","category":"page"},{"location":"04/clip-01-06/#snippet-4.5-1","page":"clip-01-06","title":"snippet 4.5","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"log_big = [log(prod(1 .+ rand(Uniform(0, 0.5), 12))) for i in 1:10000];\nfit = fit_mle(Normal, log_big)\nplot(Normal(fit.μ , fit.σ ), fill=(0, .5,:orange), lab=\"Normal distribution\")\ndensity!(log_big, lab=\"'sample' distribution\")","category":"page"},{"location":"04/clip-01-06/#snippet-4.6-1","page":"clip-01-06","title":"snippet 4.6","text":"","category":"section"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Grid of 1001 steps","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"p_grid = range(0, step=0.001, stop=1);","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"all priors = 1.0","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"prior = ones(length(p_grid));","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Binomial pdf","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"likelihood = [pdf(Binomial(9, p), 6) for p in p_grid];","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"As Uniform priar has been used, unstandardized posterior is equal to likelihood","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"posterior = likelihood .* prior;","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Scale posterior such that they become probabilities","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"posterior = posterior / sum(posterior);","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"Sample using the computed posterior values as weights In this example we keep the number of samples equal to the length of p_grid, but that is not required.","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"samples = sample(p_grid, Weights(posterior), length(p_grid));\np = Vector{Plots.Plot{Plots.GRBackend}}(undef, 2)\np[1] = scatter(1:length(p_grid), samples, markersize = 2, ylim=(0.0, 1.3), lab=\"Draws\")","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"analytical calculation","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"w = 6\nn = 9\nx = 0:0.01:1\np[2] = density(samples, ylim=(0.0, 5.0), lab=\"Sample density\")\np[2] = plot!( x, pdf.(Beta( w+1 , n-w+1 ) , x ), lab=\"Conjugate solution\")","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"quadratic approximation","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"plot!( p[2], x, pdf.(Normal( 0.67 , 0.16 ) , x ), lab=\"Normal approximation\", fill=(0, .5,:orange))\nplot(p..., layout=(1, 2))","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"End of clip-01-06.jl","category":"page"},{"location":"04/clip-01-06/#","page":"clip-01-06","title":"clip-01-06","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-07-13s.jl\"","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-07-13s/#snippet-4.7-1","page":"clip-07-13s","title":"snippet 4.7","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-07-13s/#snippet-4.8-1","page":"clip-07-13s","title":"snippet 4.8","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Show first 5 rows of DataFrame df","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"first(df, 5)","category":"page"},{"location":"04/clip-07-13s/#snippet-4.9-1","page":"clip-07-13s","title":"snippet 4.9","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Show first 5 heigth values in df","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"first(df, 5)","category":"page"},{"location":"04/clip-07-13s/#snippet-4.10-1","page":"clip-07-13s","title":"snippet 4.10","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Use only adults","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"df2 = filter(row -> row[:age] >= 18, df);","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Our model:","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"m4_1 = \"\n  height ~ Normal(μ, σ) # likelihood\n  μ ~ Normal(178,20) # prior\n  σ ~ Uniform(0, 50) # prior\n\";","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Plot the densities.","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"p = Vector{Plots.Plot{Plots.GRBackend}}(undef, 3)\np[1] = density(df2[:height], xlim=(100,250), lab=\"All heights\", xlab=\"height [cm]\", ylab=\"density\")","category":"page"},{"location":"04/clip-07-13s/#snippet-4.10-2","page":"clip-07-13s","title":"snippet 4.10","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Show  μ prior","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"d1 = Normal(178, 20)\np[2] = plot(100:250, [pdf(d1, μ) for μ in 100:250], lab=\"Prior on mu\")","category":"page"},{"location":"04/clip-07-13s/#snippet-4.11-1","page":"clip-07-13s","title":"snippet 4.11","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Show σ  prior","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"d2 = Uniform(0, 50)\np[3] = plot(0:0.1:50, [pdf(d2, σ) for σ in 0:0.1:50], lab=\"Prior on sigma\")\n\nplot(p..., layout=(3,1))","category":"page"},{"location":"04/clip-07-13s/#snippet-4.13-1","page":"clip-07-13s","title":"snippet 4.13","text":"","category":"section"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"sample_mu = rand(d1, 10000)\nsample_sigma = rand(d2, 10000)\nprior_height = [rand(Normal(sample_mu[i], sample_sigma[i]), 1)[1] for i in 1:10000]\ndf2 = DataFrame(mu = sample_mu, sigma=sample_sigma, prior_height=prior_height);\nfirst(df2, 5)","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Show density of prior_height","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"density(prior_height, lab=\"prior_height\")","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Use data from m4.1s to show CmdStan results","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Check if the m4.1s.jls file is present. If not, run the model.","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"!isfile(joinpath(ProjDir, \"m4.1s.jls\")) && include(joinpath(ProjDir, \"m4.1s.jl\"))\n\nchn = deserialize(joinpath(ProjDir, \"m4.1s.jls\"))","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Describe the draws","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"describe(chn)","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"Plot the density of posterior draws","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"density(chn)","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"End of clip-07-13s.jl","category":"page"},{"location":"04/clip-07-13s/#","page":"clip-07-13s","title":"clip-07-13s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-14-20.jl\"","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-14-20/#snippet-4.7-1","page":"clip-14-20","title":"snippet 4.7","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-14-20/#snippet-4.8-1","page":"clip-14-20","title":"snippet 4.8","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Use only adults","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"df2 = filter(row -> row[:age] >= 18, df);","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Show first 5 rows of DataFrame df","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"first(df2, 5)","category":"page"},{"location":"04/clip-14-20/#Snippet-4.14-1","page":"clip-14-20","title":"Snippet 4.14","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Generate approximate probabilities","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"struct Post\n  mu::Float64\n  sigma::Float64\n  ll:: Float64\n  prod::Float64\n  prob::Float64\nend\n\nmu_list = repeat(range(140, 160, length=200), 200);\nsigma_list = repeat(range(4, 9, length=200), inner=200);\n\nll = zeros(40000);\nfor i in 1:40000\n    d1 = Normal(mu_list[i], sigma_list[i])\n    ll[i] = sum(log.(pdf.(d1, df2[:height])))\nend\n\nd2 = Normal(178.0, 20.0)\nd3 = Uniform(0, 50)\nprod = ll + log.(pdf.(d2, mu_list)) + log.(pdf.(d3, sigma_list))\nprob = exp.(prod .- maximum(prod))\npost = DataFrame(mu=mu_list, sigma=sigma_list, ll=ll, prod=prod, prob=prob)\nfirst(post, 10)","category":"page"},{"location":"04/clip-14-20/#Snippet-4.15-1","page":"clip-14-20","title":"Snippet 4.15","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Sample post","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"samples = post[sample(1:size(post, 1), Weights(post[:prob]), 10000, replace=true), :]","category":"page"},{"location":"04/clip-14-20/#Snippet-4.19-1","page":"clip-14-20","title":"Snippet 4.19","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Density of mu","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"density(samples[:mu])","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Density of sigma","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"density(samples[:sigma])","category":"page"},{"location":"04/clip-14-20/#Snippet-4.20-1","page":"clip-14-20","title":"Snippet 4.20","text":"","category":"section"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Hdp mu","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"#hpd(samples[:mu])","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"Hdp sigma","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"#hpd(samples[:sigma])","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"End of clip-14-20.jl","category":"page"},{"location":"04/clip-14-20/#","page":"clip-14-20","title":"clip-14-20","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-21-23.jl\"","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);\ndf2 = filter(row -> row[:age] >= 18, df);\nfirst(df2, 5)","category":"page"},{"location":"04/clip-21-23/#Snippet-4.21-1","page":"clip-21-23","title":"Snippet 4.21","text":"","category":"section"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"Sample 20 random heights","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"n = size(df2, 1)\nselected_ind = sample(1:n, 20, replace=false);\ndf3 = df2[selected_ind, :];","category":"page"},{"location":"04/clip-21-23/#Snippet-4.22-1","page":"clip-21-23","title":"Snippet 4.22","text":"","category":"section"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"Generate approximate probabilities","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"struct Post\n  mu::Float64\n  sigma::Float64\n  ll:: Float64\n  prod::Float64\n  prob::Float64\nend\n\nmu_list = repeat(range(140, 170, length=200), 200);\nsigma_list = repeat(range(4, 20, length=200), inner=200);\n\nll = zeros(40000);\nfor i in 1:40000\n    d1 = Normal(mu_list[i], sigma_list[i])\n    ll[i] = sum(log.(pdf.(d1, df3[:height])))\nend\n\nd2 = Normal(178.0, 20.0)\nd3 = Uniform(0, 50)\nprod = ll + log.(pdf.(d2, mu_list)) + log.(pdf.(d3, sigma_list))\nprob = exp.(prod .- maximum(prod))\npost = DataFrame(mu=mu_list, sigma=sigma_list, ll=ll, prod=prod, prob=prob)\nfirst(post, 10)","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"Sample post","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"samples = post[sample(1:size(post, 1), Weights(post[:prob]), 10000, replace=true), :]","category":"page"},{"location":"04/clip-21-23/#Snippet-4.23-1","page":"clip-21-23","title":"Snippet 4.23","text":"","category":"section"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"Density of sigma","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"density(samples[:sigma])","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"End of clip-21-23.jl","category":"page"},{"location":"04/clip-21-23/#","page":"clip-21-23","title":"clip-21-23","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-24-29s.jl\"","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"using StatisticalRethinking, Optim\ngr(size=(500,500));","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-24-29s/#snippet-4.24-1","page":"clip-24-29s","title":"snippet 4.24","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);\ndf2 = filter(row -> row[:age] >= 18, df);\nfirst(df2, 5)","category":"page"},{"location":"04/clip-24-29s/#snippet-4.25-1","page":"clip-24-29s","title":"snippet 4.25","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"Our first model:","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"m4_1 = \"\n  height ~ Normal(μ, σ) # likelihood\n  μ ~ Normal(178,20) # prior\n  σ ~ Uniform(0, 50) # prior\n\"","category":"page"},{"location":"04/clip-24-29s/#snippet-4.26-1","page":"clip-24-29s","title":"snippet 4.26","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"Compute MAP","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"obs = df2[:height]\n\nfunction loglik(x)\n  ll = 0.0\n  ll += log(pdf(Normal(178, 20), x[1]))\n  ll += log(pdf(Uniform(0, 50), x[2]))\n  ll += sum(log.(pdf.(Normal(x[1], x[2]), obs)))\n  -ll\nend","category":"page"},{"location":"04/clip-24-29s/#snippet-4.28-1","page":"clip-24-29s","title":"snippet 4.28","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"x0 = [ 178, 10.0]\nlower = [0.0, 0.0]\nupper = [250.0, 50.0]","category":"page"},{"location":"04/clip-24-29s/#snippet-4.27-1","page":"clip-24-29s","title":"snippet 4.27","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"inner_optimizer = GradientDescent()\n\noptimize(loglik, lower, upper, x0, Fminbox(inner_optimizer))","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"Our second model:","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"m4_2 = \"\n  height ~ Normal(μ, σ) # likelihood\n  μ ~ Normal(178, 0.1) # prior\n  σ ~ Uniform(0, 50) # prior\n\"","category":"page"},{"location":"04/clip-24-29s/#snippet-4.29-1","page":"clip-24-29s","title":"snippet 4.29","text":"","category":"section"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"Compute MAP","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"obs = df2[:height]\n\nfunction loglik2(x)\n  ll = 0.0\n  ll += log(pdf(Normal(178, 0.1), x[1]))\n  ll += log(pdf(Uniform(0, 50), x[2]))\n  ll += sum(log.(pdf.(Normal(x[1], x[2]), obs)))\n  -ll\nend\n\noptimize(loglik2, lower, upper, x0, Fminbox(inner_optimizer))","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"End of clip-24-29s.jl","category":"page"},{"location":"04/clip-24-29s/#","page":"clip-24-29s","title":"clip-24-29s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-30s.jl\"","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"using StatisticalRethinking, CmdStan, LinearAlgebra\ngr(size=(500,500));","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-30s/#snippet-4.7-1","page":"clip-30s","title":"snippet 4.7","text":"","category":"section"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Use only adults","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"df2 = filter(row -> row[:age] >= 18, df);\nfirst(df2, 5)","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Use data from m4.1s","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Check if the m4.1s.jls file is present. If not, run the model.","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"!isfile(joinpath(ProjDir, \"m4.1s.jls\")) && include(joinpath(ProjDir, \"m4.1s.jl\"))\n\nchn = deserialize(joinpath(ProjDir, \"m4.1s.jls\"))","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Describe the draws","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"describe(chn)","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Plot the density of posterior draws","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"density(chn, lab=\"All heights\", xlab=\"height [cm]\", ylab=\"density\")","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Compute cor","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"mu_sigma = hcat(chn.value[:, 2, 1], chn.value[:,1, 1])\nLinearAlgebra.diag(cov(mu_sigma))","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"Compute cov","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"cor(mu_sigma)","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"End of clip_07.0s.jl","category":"page"},{"location":"04/clip-30s/#","page":"clip-30s","title":"clip-30s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-38s.jl\"","category":"page"},{"location":"04/clip-38s/#Linear-Regression-1","page":"clip-38s","title":"Linear Regression","text":"","category":"section"},{"location":"04/clip-38s/#Added-snippet-used-as-a-reference-for-all-models-1","page":"clip-38s","title":"Added snippet used as a reference for all models","text":"","category":"section"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"This model is based on the TuringTutorial example LinearRegression by Cameron Pfiffer.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Turing is powerful when applied to complex hierarchical models, but it can also be put to task at common statistical procedures, like linear regression. This tutorial covers how to implement a linear regression model in Turing.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"We begin by importing all the necessary libraries.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"using StatisticalRethinking, CmdStan, GLM\ngr(size=(500,500))\n\nProjDir = rel_path(\"..\", \"scripts\", \"00\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Import the dataset.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Use only adults","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"data = filter(row -> row[:age] >= 18, df)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Show the first six rows of the dataset.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"first(data, 6)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"The next step is to get our data ready for testing. We'll split the mtcars dataset into two subsets, one for training our model and one for evaluating our model. Then, we separate the labels we want to learn (MPG, in this case) and standardize the datasets by subtracting each column's means and dividing by the standard deviation of that column.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"The resulting data is not very familiar looking, but this standardization process helps the sampler converge far easier. We also create a function called unstandardize, which returns the standardized values to their original form. We will use this function later on when we make predictions.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Split our dataset 70%/30% into training/test sets.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"n = size(data, 1)\ntest_ind = sample(1:n, Int(floor(0.3*n)), replace=false);\ntrain_ind = [(i) for i=1:n if !(i in test_ind)];\ntest = data[test_ind, :];\ntrain = data[train_ind, :];","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Save dataframe versions of our dataset.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"train_cut = DataFrame(train)\ntest_cut = DataFrame(test)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Create our labels. These are the values we are trying to predict.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"train_label = train[:, :height]\ntest_label = test[:, :height]","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Get the list of columns to keep.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"remove_names = filter(x->!in(x, [:height, :age, :male]), names(data))","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Filter the test and train sets.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"train = Matrix(train[:, remove_names]);\ntest = Matrix(test[:, remove_names]);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"A handy helper function to rescale our dataset.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"function standardize(x)\n    return (x .- mean(x, dims=1)) ./ std(x, dims=1), x\nend","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Another helper function to unstandardize our datasets.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"function unstandardize(x, orig)\n    return x .* std(orig, dims=1) .+ mean(orig, dims=1)\nend","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Standardize our dataset.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"(train, train_orig) = standardize(train)\n(test, test_orig) = standardize(test)\n(train_label, train_l_orig) = standardize(train_label)\n(test_label, test_l_orig) = standardize(test_label);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Design matrix","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"dmat = [ones(size(train, 1)) train]","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Bayesian linear regression.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"lrmodel = \"\ndata {\n  int N; //the number of observations\n  int K; //the number of columns in the model matrix\n  real y[N]; //the response\n  matrix[N,K] X; //the model matrix\n}\nparameters {\n  vector[K] beta; //the regression parameters\n  real sigma; //the standard deviation\n}\ntransformed parameters {\n  vector[N] linpred;\n  linpred <- X*beta;\n}\nmodel {\n  beta[1] ~ cauchy(0,10); // prior for the intercept following Gelman 2008\n\n  for(i in 2:K)\n   beta[i] ~ cauchy(0,2.5); // prior for the slopes following Gelman 2008\n\n  y ~ normal(linpred,sigma);\n}\n\";","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"stanmodel = Stanmodel(name=\"linear_regression\",\n  model=lrmodel, output_format=:mcmcchains);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Input data for cmdstan","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"lrdata = Dict(\"N\" => size(train, 1), \"K\" => size(dmat, 2), \"y\" => train_label, \"X\" => dmat);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Sample using cmdstan","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"rc, chain, cnames = stan(stanmodel, lrdata, ProjDir, diagnostics=false,\n  summary=false, CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Convert to a  Chain object","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"chns = set_section(chain, Dict(\n    :parameters => [\"beta.1\", \"beta.2\", \"sigma\"],\n    :linpred => [\"linpred.$i\" for i in 1:247],\n    :internals => [\"lp__\", \"accept_stat__\", \"stepsize__\", \"treedepth__\",\n      \"n_leapfrog__\", \"divergent__\", \"energy__\"]\n  )\n)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Describe the chains.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"describe(chns)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Perform multivariate OLS.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"ols = lm(@formula(height ~ weight), train_cut)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Store our predictions in the original dataframe.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"train_cut.OLSPrediction = predict(ols);\ntest_cut.OLSPrediction = predict(ols, test_cut);","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Make a prediction given an input vector.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"function prediction(chn, x)\n    α = Array(chn[Symbol(\"beta.1\")]);\n    β = Array(chn[Symbol(\"beta.2\")]);\n    return  mean(α) .+ x .* mean(β)\nend","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Calculate the predictions for the training and testing sets.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"train_cut.BayesPredictions = unstandardize(prediction(chns, train), train_l_orig)[:,1];\ntest_cut.BayesPredictions = unstandardize(prediction(chns, test), test_l_orig)[:,1];","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Show the first side rows of the modified dataframe.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"remove_names = filter(x->!in(x, [:age, :male]), names(test_cut));\ntest_cut = test_cut[remove_names];\nfirst(test_cut, 6)\n\nbayes_loss1 = sum((train_cut.BayesPredictions - train_cut.height).^2);\nols_loss1 = sum((train_cut.OLSPrediction - train_cut.height).^2);\n\nbayes_loss2 = sum((test_cut.BayesPredictions - test_cut.height).^2);\nols_loss2 = sum((test_cut.OLSPrediction - test_cut.height).^2);\n\nprintln(\"\\nTraining set:\")\nprintln(\"  Bayes loss: $bayes_loss1\")\nprintln(\"  OLS loss: $ols_loss1\")\n\nprintln(\"Test set:\")\nprintln(\"  Bayes loss: $bayes_loss2\")\nprintln(\"  OLS loss: $ols_loss2\")","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"Plot the chains.","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"#plot(chain)","category":"page"},{"location":"04/clip-38s/#","page":"clip-38s","title":"clip-38s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-43s.jl\"","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-43s/#snippet-4.7-1","page":"clip-43s","title":"snippet 4.7","text":"","category":"section"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Use only adults","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"df2 = filter(row -> row[:age] >= 18, df);\nmean_weight = mean(df2[:weight]);\ndf2[:weight_c] = df2[:weight] .- mean_weight;\nfirst(df2, 5)","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Define the Stan language model","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"weightsmodel = \"\ndata {\n int < lower = 1 > N; // Sample size\n vector[N] height; // Predictor\n vector[N] weight; // Outcome\n}\n\nparameters {\n real alpha; // Intercept\n real beta; // Slope (regression coefficients)\n real < lower = 0 > sigma; // Error SD\n}\n\nmodel {\n height ~ normal(alpha + weight * beta , sigma);\n}\n\ngenerated quantities {\n}\n\";","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"stanmodel = Stanmodel(name=\"weights\", model=weightsmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Input data for cmdstan","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"heightsdata = Dict(\"N\" => length(df2[:height]), \"height\" => df2[:height], \"weight\" => df2[:weight_c]);","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Sample using cmdstan","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"rc, chn, cnames = stan(stanmodel, heightsdata, ProjDir, diagnostics=false,\n  summary=false, CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Describe the draws","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"describe(chn)","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Plot the density of posterior draws","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"plot(chn)","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"Plot regression line using means and observations","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"scatter(df2[:weight_c], df2[:height], lab=\"Observations\",\n  ylab=\"height [cm]\", xlab=\"weight[kg]\")\nxi = -16.0:0.1:18.0\nrws, vars, chns = size(chn)\nalpha_vals = convert(Vector{Float64}, reshape(chn.value[:, 1, :], (rws*chns)));\nbeta_vals = convert(Vector{Float64}, reshape(chn.value[:, 2, :], (rws*chns)));\nyi = mean(alpha_vals) .+ mean(beta_vals)*xi;\nplot!(xi, yi, lab=\"Regression line\")","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"End of clip-43s.jl","category":"page"},{"location":"04/clip-43s/#","page":"clip-43s","title":"clip-43s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-45-47s.jl\"","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"using StatisticalRethinking, CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-45-47s/#snippet-4.7-1","page":"clip-45-47s","title":"snippet 4.7","text":"","category":"section"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Use only adults","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"df2 = filter(row -> row[:age] >= 18, df);\nfirst(df2, 5)","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Define the Stan language model","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"weightsmodel = \"\ndata {\n int < lower = 1 > N; // Sample size\n vector[N] height; // Predictor\n vector[N] weight; // Outcome\n}\n\nparameters {\n real alpha; // Intercept\n real beta; // Slope (regression coefficients)\n real < lower = 0 > sigma; // Error SD\n}\n\nmodel {\n height ~ normal(alpha + weight * beta , sigma);\n}\n\ngenerated quantities {\n}\n\";","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"stanmodel = Stanmodel(name=\"weights\", monitors = [\"alpha\", \"beta\", \"sigma\"],model=weightsmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Input data for cmdstan","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"heightsdata = Dict(\"N\" => length(df2[:height]), \"height\" => df2[:height],\n  \"weight\" => df2[:weight]);","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Sample using cmdstan","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"rc, chn, cnames = stan(stanmodel, heightsdata, ProjDir, diagnostics=false,\n  summary=false, CmdStanDir=CMDSTAN_HOME)","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Show first 5 individual draws of correlated parameter values in chain 1","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"chn.value[1:5,:,1]","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"Plot estimates using the N = [10, 50, 150, 352] observations","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"p = Vector{Plots.Plot{Plots.GRBackend}}(undef, 4)\nnvals = [10, 50, 150, 352];","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"for i in 1:length(nvals)\n  N = nvals[i]\n  heightsdataN = [\n    Dict(\"N\" => N, \"height\" => df2[1:N, :height], \"weight\" => df2[1:N, :weight])\n  ]\n  rc, chnN, cnames = stan(stanmodel, heightsdataN, ProjDir, diagnostics=false,\n    summary=false, CmdStanDir=CMDSTAN_HOME)\n\n  xi = 30.0:0.1:65.0\n  rws, vars, chns = size(chnN)\n  alpha_vals = convert(Vector{Float64}, reshape(chnN.value[:, 1, :], (rws*chns)))\n  beta_vals = convert(Vector{Float64}, reshape(chnN.value[:, 2, :], (rws*chns)))\n\n  p[i] = scatter(df2[1:N, :weight], df2[1:N, :height], leg=false,\n    color=:darkblue, xlab=\"weight\")\n  for j in 1:N\n    yi = alpha_vals[j] .+ beta_vals[j]*xi\n    plot!(p[i], xi, yi, title=\"N = $N\", color=:lightgrey)\n  end\n  scatter!(p[i], df2[1:N, :weight], df2[1:N, :height], leg=false,\n    color=:darkblue, xlab=\"weight\")\nend\nplot(p..., layout=(2, 2))","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"End of clip_45_47s.jl","category":"page"},{"location":"04/clip-45-47s/#","page":"clip-45-47s","title":"clip-45-47s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"EditURL = \"https://github.com/StatisticalRethinkingJulia/StatisticalRethinking.jl/blob/master/scripts/04/clip-48-54s.jl\"","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Load Julia packages (libraries) needed  for the snippets in chapter 0","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"using StatisticalRethinking\nusing CmdStan\ngr(size=(500,500));","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"CmdStan uses a tmp directory to store the output of cmdstan","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"ProjDir = rel_path(\"..\", \"scripts\", \"04\")\ncd(ProjDir)","category":"page"},{"location":"04/clip-48-54s/#Preliminary-snippets-1","page":"clip-48-54s","title":"Preliminary snippets","text":"","category":"section"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"howell1 = CSV.read(rel_path(\"..\", \"data\", \"Howell1.csv\"), delim=';')\ndf = convert(DataFrame, howell1);","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Use only adults","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"df2 = filter(row -> row[:age] >= 18, df);","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Center weight and store as weight_c","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"mean_weight = mean(df2[:weight])\ndf2 = hcat(df2, df2[:weight] .- mean_weight)\nrename!(df2, :x1 => :weight_c); # Rename our col :x1 => :weight_c\nfirst(df2, 5)","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Define the Stan language model","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"weightsmodel = \"\ndata {\n int < lower = 1 > N; // Sample size\n vector[N] height; // Predictor\n vector[N] weight; // Outcome\n}\n\nparameters {\n real alpha; // Intercept\n real beta; // Slope (regression coefficients)\n real < lower = 0 > sigma; // Error SD\n}\n\nmodel {\n height ~ normal(alpha + weight * beta , sigma);\n}\n\";","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Define the Stanmodel and set the output format to :mcmcchains.","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"stanmodel = Stanmodel(name=\"weights\", monitors = [\"alpha\", \"beta\", \"sigma\"],model=weightsmodel,\n  output_format=:mcmcchains);","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Input data for cmdstan.","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"heightsdata = Dict(\"N\" => length(df2[:height]), \"height\" => df2[:height], \"weight\" => df2[:weight_c]);","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Sample using cmdstan","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"rc, chn, cnames = stan(stanmodel, heightsdata, ProjDir, diagnostics=false,\n  summary=false, CmdStanDir=CMDSTAN_HOME);","category":"page"},{"location":"04/clip-48-54s/#Snippet-4.47-1","page":"clip-48-54s","title":"Snippet 4.47","text":"","category":"section"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Show first 5 draws of correlated parameter values in chain 1","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"chn.value[1:5,:,1]","category":"page"},{"location":"04/clip-48-54s/#Snippets-4.48-and-4.49-1","page":"clip-48-54s","title":"Snippets 4.48 & 4.49","text":"","category":"section"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Plot estimates using the N = [10, 50, 150, 352] observations","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"nvals = [10, 50, 150, 352];","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Create the 4 nvals plots","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"p = Vector{Plots.Plot{Plots.GRBackend}}(undef, 4)\nfor i in 1:length(nvals)\n  N = nvals[i]\n  heightsdataN = [\n    Dict(\"N\" => N, \"height\" => df2[1:N, :height], \"weight\" => df2[1:N, :weight_c])\n  ]\n  rc, chnN, cnames = stan(stanmodel, heightsdataN, ProjDir, diagnostics=false,\n    summary=false, CmdStanDir=CMDSTAN_HOME)\n\n  rws, vars, chns = size(chnN)\n  xi = -15.0:0.1:15.0\n  alpha_vals = convert(Vector{Float64}, reshape(chnN.value[:, 1, :], (rws*chns)))\n  beta_vals = convert(Vector{Float64}, reshape(chnN.value[:, 2, :], (rws*chns)))\n\n  p[i] = scatter(df2[1:N, :weight_c], df2[1:N, :height], leg=false, xlab=\"weight_c\")\n  for j in 1:N\n    yi = alpha_vals[j] .+ beta_vals[j]*xi\n    plot!(p[i], xi, yi, title=\"N = $N\")\n  end\nend\nplot(p..., layout=(2, 2))","category":"page"},{"location":"04/clip-48-54s/#Snippet-4.50-1","page":"clip-48-54s","title":"Snippet 4.50","text":"","category":"section"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Get dimensions of chains","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"rws, vars, chns = size(chn)\nmu_at_50 = link(50:10:50, chn, [1, 2], mean_weight);\ndensity(mu_at_50)","category":"page"},{"location":"04/clip-48-54s/#Snippet-4.54-1","page":"clip-48-54s","title":"Snippet 4.54","text":"","category":"section"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"Show posterior density for 6 mu_bar values","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"mu = link(25:10:75, chn, [1, 2], mean_weight);\n\nq = Vector{Plots.Plot{Plots.GRBackend}}(undef, size(mu, 1))\nfor i in 1:size(mu, 1)\n  q[i] = density(mu[i], ylim=(0.0, 1.5),\n    leg=false, title=\"mu_bar = $(round(mean(mu[i]), digits=1))\")\nend\nplot(q..., layout=(2, 3), ticks=(3))","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"End of clip_48_54s.jl","category":"page"},{"location":"04/clip-48-54s/#","page":"clip-48-54s","title":"clip-48-54s","text":"This page was generated using Literate.jl.","category":"page"},{"location":"#","page":"Functions","title":"Functions","text":"CurrentModule = StatisticalRethinking","category":"page"},{"location":"#link-1","page":"Functions","title":"link","text":"","category":"section"},{"location":"#","page":"Functions","title":"Functions","text":"link(xrange, chain, vars, xbar) ","category":"page"},{"location":"#StatisticalRethinking.link-NTuple{4,Any}","page":"Functions","title":"StatisticalRethinking.link","text":"link\n\nCompute the link function\n\nMethod\n\nlink(xrange, chain, vars, xbar) \n\nRequired arguments\n\n* `xrange::Turing model`  : Range over which link values are computed\n* `chain::Float64`             : Chain samples used\n* `vars::Float64`               : Variables in chain used\n* `xbar::Float64`               : Mean value of observed predictor\n\nReturn values\n\n* `result`                       : Vector of link values\n\n\n\n\n\n","category":"method"},{"location":"#rel_path-1","page":"Functions","title":"rel_path","text":"","category":"section"},{"location":"#","page":"Functions","title":"Functions","text":"rel_path(parts...)","category":"page"},{"location":"#StatisticalRethinking.rel_path-Tuple","page":"Functions","title":"StatisticalRethinking.rel_path","text":"rel_path\n\nRelative path using the StatisticalRethinking src/ directory. Copied from DynamicHMCExamples.jl\n\nExample to get access to the data subdirectory\n\nrel_path(\"..\", \"data\")\n\n\n\n\n\n","category":"method"},{"location":"#generate-1","page":"Functions","title":"generate","text":"","category":"section"},{"location":"#","page":"Functions","title":"Functions","text":"generate(; sd=script_dict)\ngenerate(chapter::AbstractString; sd=script_dict)\ngenerate(chapter::AbstractString, scriptfile::AbstractString; sd=script_dict)","category":"page"},{"location":"#StatisticalRethinking.generate-Tuple{}","page":"Functions","title":"StatisticalRethinking.generate","text":"generate\n\nUtility function to generate all notebooks and chapters from scripts in the scripts directory.\n\nMethod\n\ngenerate(sd = script_dict)\n\nRequired arguments\n\nNone, all notebooks/.. and chapters/.. files are regenerated.\n\n\n\n\n\n","category":"method"},{"location":"#StatisticalRethinking.generate-Tuple{AbstractString}","page":"Functions","title":"StatisticalRethinking.generate","text":"generate\n\nGenerate notebooks and scripts in a single chapter.\n\nMethod\n\ngenerate(chapter::AbstractString)\n\nRequired arguments\n\nGenerate notebooks and scripts in a single chapter, e.g. generate(\"04\")\n\n\n\n\n\n","category":"method"},{"location":"#StatisticalRethinking.generate-Tuple{AbstractString,AbstractString}","page":"Functions","title":"StatisticalRethinking.generate","text":"generate\n\nGenerate a single notebook and script\n\nMethod\n\ngenerate(chapter::AbstractString, file::AbstractString)\n\nRequired arguments\n\nGenerate notebook and script file in chapter, e.g. generate(\"04\", \"m4.1d.jl\") or  generate(\"04/m4.1d.jl\")\n\n\n\n\n\n","category":"method"},{"location":"#ScriptEntry-1","page":"Functions","title":"ScriptEntry","text":"","category":"section"},{"location":"#","page":"Functions","title":"Functions","text":"ScriptEntry","category":"page"},{"location":"#StatisticalRethinking.ScriptEntry","page":"Functions","title":"StatisticalRethinking.ScriptEntry","text":"ScriptEntry\n\nDefine processing requirements for chapter scripts\n\nConstructor\n\nscriptentry(scriptfile;; nb=true, exe=true, doc=true)\n\nRequired arguments\n\n* `scriptfile::AbstractString`        : Script file\n\nOptional arguments\n\n* `nb::Bool`      : Generate a notebook version in notebooks directory\n* `exe::Bool`     : Execute the notebook (for testing or documentation purposes)\n* `doc::Bool`     : Insert documention into Github pages\n\nIf exe = false and doc = true it is assumed the appropriate .md files have been manually created and stored in docs/src/nn/... (Travis will terminate if runs take too long).\n\n\n\n\n\n","category":"type"},{"location":"#scriptentry-1","page":"Functions","title":"scriptentry","text":"","category":"section"},{"location":"#","page":"Functions","title":"Functions","text":"scriptentry(scriptfile; nb = true, exe = true, doc = true)","category":"page"},{"location":"#StatisticalRethinking.scriptentry-Tuple{Any}","page":"Functions","title":"StatisticalRethinking.scriptentry","text":"scriptentry\n\nConstructor for ScriptEntry objects.\n\nConstructor\n\nscriptentry(scriptfile;; nb=true, exe=true, doc=true)\n\nRequired arguments\n\n* `scriptfile::AbstractString`        : Script file\n\nOptional arguments\n\n* `nb::Bool`      : Generate a notebook version in notebooks directory\n* `exe::Bool`     : Execute the notebook (for testing or documentation purposes)\n* `doc::Bool`     : Insert documention into Github pages\n\nIf exe = false and doc = true it is assumed the appropriate .md files have been manually created and stored in docs/src/nn/... (Travis will terminate if runs take too long).\n\n\n\n\n\n","category":"method"}]
}
