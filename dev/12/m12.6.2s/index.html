<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6.2s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2d/">m4.2d</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5d1/">m4.5d1</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/clip-01d/">clip-01d</a></li><li><a class="toctext" href="../../05/clip-01s/">clip-01s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1/">m8.1</a></li><li><a class="toctext" href="../../08/m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../m12.6.1s/">m12.6.1s</a></li><li class="current"><a class="toctext" href>m12.6.2s</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6.2s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6.2s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6.2s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col log_pop, set log() for population data</p><div><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;

first(d, 5)

m12_6 = &quot;
  data {
    int N;
    int T[N];
    int N_societies;
    int society[N];
    int P[N];
  }
  parameters {
    real alpha;
    vector[N_societies] a_society;
    real bp;
    real&lt;lower=0&gt; sigma_society;
  }
  model {
    vector[N] mu;
    target += normal_lpdf(alpha | 0, 10);
    target += normal_lpdf(bp | 0, 1);
    target += cauchy_lpdf(sigma_society | 0, 1);
    target += normal_lpdf(a_society | 0, sigma_society);
    for(i in 1:N) mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
    target += poisson_log_lpmf(T | mu);
  }
  generated quantities {
    vector[N] log_lik;
    {
    vector[N] mu;
    for(i in 1:N) {
      mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
      log_lik[i] = poisson_log_lpmf(T[i] | mu[i]);
    }
    }
  }
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6&quot;,  model=m12_6, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_data = Dict(&quot;N&quot; =&gt; size(d, 1), &quot;T&quot; =&gt; d[:total_tools], &quot;N_societies&quot; =&gt; 10, &quot;society&quot; =&gt; d[:society], &quot;P&quot; =&gt; d[:population]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_data, ProjDir, diagnostics=false, summary=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp
Model name=m12_6_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a
Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
Exception: normal_lpdf: Scale parameter is 0, but must be &gt; 0!  (in &#39;/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan&#39; at line 19)

If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.

Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
Exception: normal_lpdf: Scale parameter is 0, but must be &gt; 0!  (in &#39;/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan&#39; at line 19)

If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
                   Mean          SD       Naive SE       MCSE         ESS
         lp__ -39.767281400  3.23225050 0.0511063678 0.1029984526  984.801322
accept_stat__   0.945846978  0.07368873 0.0011651211 0.0012835116 1000.000000
   stepsize__   0.048147775  0.00663110 0.0001048469 0.0010616930   39.009752
  treedepth__   5.948000000  0.48667773 0.0076950506 0.0246883134  388.597591
 n_leapfrog__  76.264000000 36.00142122 0.5692324502 1.6781142041  460.252615
  divergent__   0.000000000  0.00000000 0.0000000000 0.0000000000         NaN
     energy__  46.291110550  4.08144127 0.0645332528 0.1161535711 1000.000000
        alpha   1.098419683  0.77576091 0.0122658569 0.0257617475  906.786701
  a_society.1  -0.213079627  0.25724959 0.0040674732 0.0070755082 1000.000000
  a_society.2   0.046251350  0.22916648 0.0036234403 0.0056437731 1000.000000
  a_society.3  -0.048137255  0.20330166 0.0032144815 0.0046174741 1000.000000
  a_society.4   0.332326063  0.19325117 0.0030555693 0.0049037975 1000.000000
  a_society.5   0.041234632  0.17792054 0.0028131708 0.0039698783 1000.000000
  a_society.6  -0.328061472  0.21056033 0.0033292512 0.0047853947 1000.000000
  a_society.7   0.148799919  0.17553803 0.0027754999 0.0037473807 1000.000000
  a_society.8  -0.177351572  0.19111382 0.0030217749 0.0044639408 1000.000000
  a_society.9   0.278712690  0.17854763 0.0028230858 0.0042387410 1000.000000
 a_society.10  -0.096083612  0.30056940 0.0047524195 0.0092270632 1000.000000
           bp   0.261148729  0.08418746 0.0013311206 0.0028002663  903.849559
sigma_society   0.321563498  0.13676168 0.0021623921 0.0038246248 1000.000000
    log_lik.1  -2.762410085  0.70799479 0.0111943805 0.0122998319 1000.000000
    log_lik.2  -2.863049963  0.54834785 0.0086701408 0.0136665914 1000.000000
    log_lik.3  -2.874494505  0.52577746 0.0083132715 0.0100905813 1000.000000
    log_lik.4  -3.529974685  0.92098538 0.0145620574 0.0203849262 1000.000000
    log_lik.5  -3.050962187  0.55057108 0.0087052932 0.0086293549 1000.000000
    log_lik.6  -3.118138900  0.87043473 0.0137627816 0.0216863718 1000.000000
    log_lik.7  -3.220085147  0.61456137 0.0097170684 0.0105548926 1000.000000
    log_lik.8  -3.061087195  0.64656795 0.0102231370 0.0150272530 1000.000000
    log_lik.9  -3.545031327  0.81444722 0.0128775412 0.0188313122 1000.000000
   log_lik.10  -3.535994118  0.70392390 0.0111300142 0.0141123283 1000.000000

Quantiles:
                   2.5%         25.0%         50.0%        75.0%         97.5%
         lp__ -47.008567500 -41.717200000 -39.56945000 -37.447125000 -34.28489250
accept_stat__   0.729816125   0.923084250   0.97804400   0.996517250   0.99997302
   stepsize__   0.037636100   0.045708800   0.04958110   0.052020075   0.05579280
  treedepth__   5.000000000   6.000000000   6.00000000   6.000000000   7.00000000
 n_leapfrog__  31.000000000  63.000000000  63.00000000  63.000000000 127.00000000
  divergent__   0.000000000   0.000000000   0.00000000   0.000000000   0.00000000
     energy__  39.071315000  43.475725000  46.05735000  48.859700000  54.75705250
        alpha  -0.476630950   0.647183500   1.11900000   1.558860000   2.64431050
  a_society.1  -0.772239700  -0.366436250  -0.19759050  -0.043778350   0.27386505
  a_society.2  -0.388829575  -0.097621325   0.03968110   0.185406250   0.51590535
  a_society.3  -0.458246100  -0.170046000  -0.04604200   0.076903825   0.34629960
  a_society.4  -0.027437680   0.200155500   0.32581300   0.460834250   0.72289095
  a_society.5  -0.315214175  -0.066835000   0.03643710   0.151804000   0.41383328
  a_society.6  -0.800925950  -0.452043750  -0.31197550  -0.183085750   0.04623047
  a_society.7  -0.189265350   0.032977925   0.14316300   0.259370750   0.51229333
  a_society.8  -0.568566000  -0.293619500  -0.16580700  -0.048189225   0.17440137
  a_society.9  -0.044550012   0.159956000   0.27657900   0.389633000   0.65184117
 a_society.10  -0.721650800  -0.260283750  -0.09194855   0.067411750   0.51498565
           bp   0.092984618   0.211009500   0.25931400   0.310070000   0.43665038
sigma_society   0.123745075   0.228664750   0.29622850   0.387685000   0.65263458
    log_lik.1  -4.738243250  -2.990990000  -2.49381000  -2.273337500  -2.20838925
    log_lik.2  -4.452651000  -2.991102500  -2.64336500  -2.506190000  -2.46858000
    log_lik.3  -4.354755500  -2.976012500  -2.67576000  -2.548500000  -2.51191000
    log_lik.4  -6.081436750  -3.849570000  -3.17508500  -2.888890000  -2.80242900
    log_lik.5  -4.706466250  -3.167515000  -2.82975000  -2.707195000  -2.67017975
    log_lik.6  -5.646009250  -3.427327500  -2.79856000  -2.502397500  -2.39634000
    log_lik.7  -4.992677750  -3.374165000  -2.98487000  -2.817385000  -2.76589000
    log_lik.8  -4.882144250  -3.236695000  -2.81326500  -2.637707500  -2.58840000
    log_lik.9  -5.940258000  -3.774010000  -3.23613500  -2.996080000  -2.92497000
   log_lik.10  -5.430570250  -3.682562500  -3.26665000  -3.101765000  -3.05199975</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m12.6.1s/"><span class="direction">Previous</span><span class="title">m12.6.1s</span></a><a class="next" href="../../13/m13.2s/"><span class="direction">Next</span><span class="title">m13.2s</span></a></footer></article></body></html>
