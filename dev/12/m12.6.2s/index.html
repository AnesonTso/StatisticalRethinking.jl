<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6.2s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/m5.1d/">m5.1d</a></li><li><a class="toctext" href="../../05/m5.1s/">m5.1s</a></li><li><a class="toctext" href="../../05/m5.6d/">m5.6d</a></li><li><a class="toctext" href="../../05/m5.6s/">m5.6s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1d/">m8.1d</a></li><li><a class="toctext" href="../../08/m8.1s/">m8.1s</a></li><li><a class="toctext" href="../../08/m8.1t/">m8.1t</a></li><li><a class="toctext" href="../../08/m8.3t/">m8.3t</a></li><li><a class="toctext" href="../../08/m8.5s/">m8.5s</a></li><li><a class="toctext" href="../../08/m8.8s/">m8.8s</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../m12.6.1s/">m12.6.1s</a></li><li class="current"><a class="toctext" href>m12.6.2s</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6.2s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6.2s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6.2s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col log_pop, set log() for population data</p><div><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;

first(d, 5)

m12_6 = &quot;
  data {
    int N;
    int T[N];
    int N_societies;
    int society[N];
    int P[N];
  }
  parameters {
    real alpha;
    vector[N_societies] a_society;
    real bp;
    real&lt;lower=0&gt; sigma_society;
  }
  model {
    vector[N] mu;
    target += normal_lpdf(alpha | 0, 10);
    target += normal_lpdf(bp | 0, 1);
    target += cauchy_lpdf(sigma_society | 0, 1);
    target += normal_lpdf(a_society | 0, sigma_society);
    for(i in 1:N) mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
    target += poisson_log_lpmf(T | mu);
  }
  generated quantities {
    vector[N] log_lik;
    {
    vector[N] mu;
    for(i in 1:N) {
      mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
      log_lik[i] = poisson_log_lpmf(T[i] | mu[i]);
    }
    }
  }
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6&quot;,  model=m12_6, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_data = Dict(&quot;N&quot; =&gt; size(d, 1), &quot;T&quot; =&gt; d[:total_tools], &quot;N_societies&quot; =&gt; 10, &quot;society&quot; =&gt; d[:society], &quot;P&quot; =&gt; d[:population]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_data, ProjDir, diagnostics=false, summary=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp
Model name=m12_6_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
                   Mean           SD         Naive SE       MCSE         ESS
         lp__ -39.702124550  3.0967335743 0.04896365701 0.1028200530  907.093467
accept_stat__   0.938768447  0.0841008494 0.00132975119 0.0016922634 1000.000000
   stepsize__   0.056461075  0.0025941536 0.00004101717 0.0004153451   39.009752
  treedepth__   5.824500000  0.4703775757 0.00743732250 0.0168931408  775.304700
 n_leapfrog__  68.712000000 30.6577238230 0.48474117579 1.0931762239  786.501328
  divergent__   0.000000000  0.0000000000 0.00000000000 0.0000000000         NaN
     energy__  46.205447100  4.0258435116 0.06365417500 0.1272936855 1000.000000
        alpha   1.082590166  0.7591296237 0.01200289325 0.0249839149  923.232098
  a_society.1  -0.204345046  0.2508875804 0.00396688095 0.0064402335 1000.000000
  a_society.2   0.048200566  0.2269802694 0.00358887318 0.0064080341 1000.000000
  a_society.3  -0.046674942  0.1983466532 0.00313613595 0.0047556874 1000.000000
  a_society.4   0.333544495  0.1967994532 0.00311167257 0.0054332848 1000.000000
  a_society.5   0.044891687  0.1824252255 0.00288439608 0.0034696995 1000.000000
  a_society.6  -0.323096177  0.2153303423 0.00340467166 0.0052633082 1000.000000
  a_society.7   0.147249803  0.1809647434 0.00286130383 0.0038879657 1000.000000
  a_society.8  -0.175672586  0.1915477499 0.00302863585 0.0035752837 1000.000000
  a_society.9   0.276807931  0.1792084050 0.00283353368 0.0043225711 1000.000000
 a_society.10  -0.103340429  0.3041873355 0.00480962408 0.0087659799 1000.000000
           bp   0.263013585  0.0824923962 0.00130431931 0.0026964112  935.956351
sigma_society   0.318607216  0.1312979441 0.00207600278 0.0043261971  921.092510
    log_lik.1  -2.749679983  0.7040007206 0.01113122876 0.0137511275 1000.000000
    log_lik.2  -2.835500902  0.5157110848 0.00815410821 0.0088387955 1000.000000
    log_lik.3  -2.852872050  0.5041203159 0.00797084206 0.0097152236 1000.000000
    log_lik.4  -3.557282670  0.9488776339 0.01500307272 0.0210215940 1000.000000
    log_lik.5  -3.060204762  0.5614557402 0.00887739472 0.0114253013 1000.000000
    log_lik.6  -3.150887003  0.8927925575 0.01411628980 0.0148582648 1000.000000
    log_lik.7  -3.237277558  0.6206122441 0.00981274118 0.0097252009 1000.000000
    log_lik.8  -3.031918680  0.5904011849 0.00933506239 0.0104525681 1000.000000
    log_lik.9  -3.533023473  0.8025204184 0.01268896195 0.0175495821 1000.000000
   log_lik.10  -3.525794542  0.6784294694 0.01072691178 0.0154362295 1000.000000

Quantiles:
                   2.5%         25.0%        50.0%        75.0%         97.5%
         lp__ -46.535112500 -41.56345000 -39.38445000 -37.537850000 -34.557340000
accept_stat__   0.691658000   0.91339625   0.97494150   0.996060500   0.999967000
   stepsize__   0.053878800   0.05451015   0.05567960   0.057630525   0.060606300
  treedepth__   5.000000000   6.00000000   6.00000000   6.000000000   7.000000000
 n_leapfrog__  31.000000000  63.00000000  63.00000000  63.000000000 127.000000000
  divergent__   0.000000000   0.00000000   0.00000000   0.000000000   0.000000000
     energy__  39.280205000  43.37000000  45.81745000  48.721300000  54.899677500
        alpha  -0.507231975   0.63909275   1.09955000   1.545250000   2.562001750
  a_society.1  -0.764069875  -0.34565975  -0.18326950  -0.040694975   0.248438950
  a_society.2  -0.392728725  -0.09074757   0.04727650   0.186630250   0.510276600
  a_society.3  -0.460271075  -0.17305550  -0.04308125   0.085654075   0.334110325
  a_society.4  -0.027547542   0.20682150   0.32362900   0.453936000   0.746672300
  a_society.5  -0.319655850  -0.06955595   0.04664330   0.159075750   0.421704750
  a_society.6  -0.781676425  -0.45253825  -0.30791750  -0.172312000   0.049218755
  a_society.7  -0.191119375   0.03002180   0.14019100   0.260917500   0.511358050
  a_society.8  -0.577631275  -0.29370575  -0.16255600  -0.050669625   0.179249350
  a_society.9  -0.057600453   0.16082725   0.27358000   0.384243750   0.644318050
 a_society.10  -0.755204250  -0.27082925  -0.08902735   0.071575625   0.488032800
           bp   0.101373000   0.21132100   0.26077750   0.310682000   0.434358850
sigma_society   0.133081100   0.22895875   0.29593700   0.382357750   0.637862200
    log_lik.1  -4.752407000  -2.96185500  -2.49018500  -2.270977500  -2.208399750
    log_lik.2  -4.380971750  -2.96499750  -2.63273500  -2.503330000  -2.468659500
    log_lik.3  -4.264619250  -2.95422000  -2.66131500  -2.543640000  -2.511679750
    log_lik.4  -6.277587250  -3.85846000  -3.18826000  -2.889387500  -2.802569500
    log_lik.5  -4.679619250  -3.17179500  -2.84304500  -2.706835000  -2.670090000
    log_lik.6  -5.619157750  -3.49688500  -2.83175000  -2.502497500  -2.396559750
    log_lik.7  -4.955454750  -3.41331250  -3.00420500  -2.821942500  -2.765979500
    log_lik.8  -4.760327250  -3.17467500  -2.79986000  -2.638917500  -2.588519750
    log_lik.9  -5.719840750  -3.77743500  -3.22810000  -2.987347500  -2.924719750
   log_lik.10  -5.378125250  -3.68164750  -3.26698500  -3.095142500  -3.051949500</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m12.6.1s/"><span class="direction">Previous</span><span class="title">m12.6.1s</span></a><a class="next" href="../../13/m13.2s/"><span class="direction">Next</span><span class="title">m13.2s</span></a></footer></article></body></html>
