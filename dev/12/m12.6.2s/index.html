<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6.2s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/clip-01s/">clip-01s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1/">m8.1</a></li><li><a class="toctext" href="../../08/m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../m12.6.1s/">m12.6.1s</a></li><li class="current"><a class="toctext" href>m12.6.2s</a><ul class="internal"></ul></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6.2s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6.2s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6.2s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col log_pop, set log() for population data</p><div><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;

first(d, 5)

m12_6 = &quot;
  data {
    int N;
    int T[N];
    int N_societies;
    int society[N];
    int P[N];
  }
  parameters {
    real alpha;
    vector[N_societies] a_society;
    real bp;
    real&lt;lower=0&gt; sigma_society;
  }
  model {
    vector[N] mu;
    target += normal_lpdf(alpha | 0, 10);
    target += normal_lpdf(bp | 0, 1);
    target += cauchy_lpdf(sigma_society | 0, 1);
    target += normal_lpdf(a_society | 0, sigma_society);
    for(i in 1:N) mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
    target += poisson_log_lpmf(T | mu);
  }
  generated quantities {
    vector[N] log_lik;
    {
    vector[N] mu;
    for(i in 1:N) {
      mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
      log_lik[i] = poisson_log_lpmf(T[i] | mu[i]);
    }
    }
  }
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6&quot;,  model=m12_6, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_data = Dict(&quot;N&quot; =&gt; size(d, 1), &quot;T&quot; =&gt; d[:total_tools], &quot;N_societies&quot; =&gt; 10, &quot;society&quot; =&gt; d[:society], &quot;P&quot; =&gt; d[:population]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_data, ProjDir, diagnostics=false, summary=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp
Model name=m12_6_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
                   Mean           SD         Naive SE         MCSE         ESS
         lp__ -39.681110400  3.0724703852 0.048580022304 0.09937381057  955.941958
accept_stat__   0.938002307  0.0867543693 0.001371707019 0.00183571571 1000.000000
   stepsize__   0.051135975  0.0012203336 0.000019295168 0.00019538533   39.009752
  treedepth__   5.895250000  0.4126984583 0.006525335576 0.00956748969 1000.000000
 n_leapfrog__  71.987000000 31.6154347579 0.499883915257 0.56274307568 1000.000000
  divergent__   0.000000000  0.0000000000 0.000000000000 0.00000000000         NaN
     energy__  46.215134925  4.0628694501 0.064239606490 0.11938656112 1000.000000
        alpha   1.055910104  0.7370203886 0.011653315550 0.02000167053 1000.000000
  a_society.1  -0.194599988  0.2463641663 0.003895359497 0.00554205475 1000.000000
  a_society.2   0.054121163  0.2222873184 0.003514671105 0.00501619961 1000.000000
  a_society.3  -0.043183507  0.2024016392 0.003200250910 0.00355673947 1000.000000
  a_society.4   0.330864141  0.1847713352 0.002921491327 0.00458487545 1000.000000
  a_society.5   0.044797644  0.1778207266 0.002811592557 0.00312478951 1000.000000
  a_society.6  -0.319458844  0.2074089371 0.003279423241 0.00416539040 1000.000000
  a_society.7   0.145173730  0.1738649355 0.002749046008 0.00330173131 1000.000000
  a_society.8  -0.176553523  0.1873630707 0.002962470263 0.00430535718 1000.000000
  a_society.9   0.272526057  0.1671419765 0.002642746693 0.00364335801 1000.000000
 a_society.10  -0.107840984  0.2762841410 0.004368435835 0.00756070165 1000.000000
           bp   0.265671014  0.0787405374 0.001244997212 0.00214840361 1000.000000
sigma_society   0.310554955  0.1250155218 0.001976668959 0.00437433887  816.776114
    log_lik.1  -2.750221220  0.6904419231 0.010916845345 0.01280961878 1000.000000
    log_lik.2  -2.833238590  0.5298938086 0.008378356765 0.01163211766 1000.000000
    log_lik.3  -2.884350940  0.5140129304 0.008127258034 0.01081884022 1000.000000
    log_lik.4  -3.551535457  0.9234728487 0.014601387796 0.02069991463 1000.000000
    log_lik.5  -3.057741767  0.5843031905 0.009238644630 0.01233070899 1000.000000
    log_lik.6  -3.172403345  0.9456672930 0.014952312773 0.02028805178 1000.000000
    log_lik.7  -3.241620548  0.6580588490 0.010404823986 0.01168474913 1000.000000
    log_lik.8  -3.050727025  0.6404277043 0.010126051111 0.01442794053 1000.000000
    log_lik.9  -3.554679710  0.8151826689 0.012889169714 0.01639957871 1000.000000
   log_lik.10  -3.544099077  0.6787612343 0.010732157440 0.01114932222 1000.000000

Quantiles:
                   2.5%         25.0%         50.0%        75.0%         97.5%
         lp__ -46.323490000 -41.543750000 -39.35920000 -37.525950000 -34.542715000
accept_stat__   0.679668100   0.914488000   0.97479450   0.996004500   0.999969025
   stepsize__   0.050169800   0.050214425   0.05059790   0.051519450   0.053178300
  treedepth__   5.000000000   6.000000000   6.00000000   6.000000000   7.000000000
 n_leapfrog__  31.000000000  63.000000000  63.00000000  63.000000000 127.000000000
  divergent__   0.000000000   0.000000000   0.00000000   0.000000000   0.000000000
     energy__  39.322487500  43.254850000  45.92600000  48.750900000  54.781090000
        alpha  -0.469028650   0.628155000   1.08330000   1.511455000   2.426484250
  a_society.1  -0.717170450  -0.341369000  -0.18261250  -0.035820275   0.266100700
  a_society.2  -0.348506600  -0.089746525   0.04287430   0.183987000   0.519309800
  a_society.3  -0.451429850  -0.171791000  -0.04254405   0.088189750   0.353297250
  a_society.4  -0.004675618   0.206350000   0.32435200   0.448055500   0.713799875
  a_society.5  -0.314154725  -0.066003425   0.04006435   0.157434500   0.401696625
  a_society.6  -0.776612100  -0.438866750  -0.30570350  -0.182600750   0.052950075
  a_society.7  -0.186198875   0.025798450   0.14405550   0.257554000   0.499045100
  a_society.8  -0.564284000  -0.294660500  -0.16816800  -0.054065575   0.180002775
  a_society.9  -0.041093997   0.158952000   0.26648550   0.381451000   0.618760500
 a_society.10  -0.716908700  -0.265894250  -0.09840540   0.056744350   0.430871275
           bp   0.119123100   0.216562000   0.26302950   0.311597250   0.428063525
sigma_society   0.131257000   0.223706500   0.28875450   0.372079000   0.611648550
    log_lik.1  -4.643016750  -2.965435000  -2.49454000  -2.274237500  -2.208559500
    log_lik.2  -4.408577750  -2.938510000  -2.63813000  -2.504417500  -2.468659500
    log_lik.3  -4.381105500  -3.000762500  -2.69007500  -2.551860000  -2.511880000
    log_lik.4  -6.075879000  -3.863902500  -3.20173000  -2.893865000  -2.802539500
    log_lik.5  -4.690867250  -3.157060000  -2.83977500  -2.707055000  -2.670110000
    log_lik.6  -5.839857250  -3.484405000  -2.83770000  -2.504160000  -2.396919000
    log_lik.7  -5.147211500  -3.386810000  -2.98142500  -2.813965000  -2.766059750
    log_lik.8  -4.816645500  -3.217692500  -2.80780500  -2.633147500  -2.588300000
    log_lik.9  -5.822649000  -3.772237500  -3.23612500  -2.995012500  -2.925039500
   log_lik.10  -5.446500750  -3.720142500  -3.27268000  -3.097315000  -3.052010000</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m12.6.1s/"><span class="direction">Previous</span><span class="title">m12.6.1s</span></a><a class="next" href="../../"><span class="direction">Next</span><span class="title">Functions</span></a></footer></article></body></html>
