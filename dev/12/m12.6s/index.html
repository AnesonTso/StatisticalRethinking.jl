<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/m5.1d/">m5.1d</a></li><li><a class="toctext" href="../../05/m5.1s/">m5.1s</a></li><li><a class="toctext" href="../../05/m5.6d/">m5.6d</a></li><li><a class="toctext" href="../../05/m5.6s/">m5.6s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1d/">m8.1d</a></li><li><a class="toctext" href="../../08/m8.1s/">m8.1s</a></li><li><a class="toctext" href="../../08/m8.1t/">m8.1t</a></li><li><a class="toctext" href="../../08/m8.3t/">m8.3t</a></li><li><a class="toctext" href="../../08/m8.5s/">m8.5s</a></li><li><a class="toctext" href="../../08/m8.8s/">m8.8s</a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li><a class="toctext" href="../../10/m10.01s/">m10.01s</a></li><li><a class="toctext" href="../../10/m10.02d/">m10.02d</a></li><li><a class="toctext" href="../../10/m10.02s/">m10.02s</a></li><li><a class="toctext" href="../../10/m10.04d/">m10.04d</a></li><li><a class="toctext" href="../../10/m10.04s/">m10.04s</a></li></ul></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../m12.6d/">m12.6d</a></li><li class="current"><a class="toctext" href>m12.6s</a><ul class="internal"></ul></li><li><a class="toctext" href="../m12.6s2/">m12.6s2</a></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)
cd(ProjDir)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col log_pop, set log() for population data</p><div><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;
first(d[[:culture, :population, :log_pop, :society]], 5)

m12_6 = &quot;
data {
    int N;
    int N_societies;
    int total_tools[N];
    real logpop[N];
    int society[N];
}
parameters{
    real a;
    real bp;
    vector[N_societies] a_society;
    real&lt;lower=0&gt; sigma_society;
}
model{
    vector[N_societies] mu;
    sigma_society ~ cauchy( 0 , 1 );
    a_society ~ normal( 0 , sigma_society );
    bp ~ normal( 0 , 1 );
    a ~ normal( 0 , 10 );
    for ( i in 1:N ) {
        mu[i] = a + a_society[society[i]] + bp * logpop[i];
        mu[i] = exp(mu[i]);
    }
    total_tools ~ poisson( mu );
}
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6&quot;,  model=m12_6, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_data = Dict(&quot;N&quot; =&gt; size(d, 1),&quot;N_societies&quot; =&gt; 10,
&quot;total_tools&quot; =&gt; d[:total_tools], &quot;logpop&quot; =&gt; d[:log_pop],
&quot;society&quot; =&gt; d[:society]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_data, ProjDir, diagnostics=false, summary=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp
Model name=m12_6_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
                   Mean            SD         Naive SE        MCSE         ESS
         lp__  927.809771500  3.1845419788 0.050352029787 0.1052383301  915.684915
accept_stat__    0.949222946  0.0718760721 0.001136460485 0.0008819624 1000.000000
   stepsize__    0.045928500  0.0060888424 0.000096273052 0.0009748732   39.009752
  treedepth__    6.016250000  0.4791067974 0.007575343612 0.0245202363  381.781925
 n_leapfrog__   82.248000000 39.0159846443 0.616896883151 1.8525874906  443.534788
  divergent__    0.000000000  0.0000000000 0.000000000000 0.0000000000         NaN
     energy__ -921.289745750  4.1180139932 0.065111518275 0.1232379573 1000.000000
            a    1.083835116  0.7439308630 0.011762579744 0.0186066989 1000.000000
           bp    0.262995630  0.0805753439 0.001274008050 0.0019024138 1000.000000
  a_society.1   -0.205394132  0.2462260162 0.003893175152 0.0044375148 1000.000000
  a_society.2    0.046894050  0.2201155962 0.003480333163 0.0050449527 1000.000000
  a_society.3   -0.051213633  0.2031878380 0.003212681804 0.0040351027 1000.000000
  a_society.4    0.332741504  0.1912412937 0.003023790353 0.0057470108 1000.000000
  a_society.5    0.043186641  0.1844528375 0.002916455438 0.0040458947 1000.000000
  a_society.6   -0.317144553  0.2068091607 0.003269939944 0.0040927397 1000.000000
  a_society.7    0.147649335  0.1759613108 0.002782192611 0.0039435281 1000.000000
  a_society.8   -0.178823050  0.1867256493 0.002952391747 0.0028627629 1000.000000
  a_society.9    0.273879285  0.1766264750 0.002792709780 0.0043253006 1000.000000
 a_society.10   -0.099466120  0.2905386915 0.004593820068 0.0058645512 1000.000000
sigma_society    0.316220667  0.1322710659 0.002091389184 0.0041105590 1000.000000

Quantiles:
                   2.5%           25.0%         50.0%          75.0%         97.5%
         lp__  920.825100000  925.940500000  928.11850000  929.995250000  933.13217500
accept_stat__    0.732043775    0.929941500    0.97858150    0.996916750    0.99996400
   stepsize__    0.037664700    0.042941925    0.04564370    0.048630275    0.05476190
  treedepth__    5.000000000    6.000000000    6.00000000    6.000000000    7.00000000
 n_leapfrog__   31.000000000   63.000000000   63.00000000  127.000000000  127.80000000
  divergent__    0.000000000    0.000000000    0.00000000    0.000000000    0.00000000
     energy__ -928.330200000 -924.120250000 -921.68000000 -918.733250000 -912.47212500
            a   -0.498433900    0.659444750    1.12419500    1.554847500    2.45149175
           bp    0.114040250    0.212638000    0.25919500    0.308155250    0.43558528
  a_society.1   -0.746881600   -0.346825750   -0.18661900   -0.047052900    0.23328840
  a_society.2   -0.368703750   -0.089938075    0.03716335    0.179730750    0.50955985
  a_society.3   -0.459564150   -0.175809500   -0.04554645    0.075839125    0.35011805
  a_society.4   -0.008178023    0.198974750    0.32228600    0.455790500    0.73223978
  a_society.5   -0.306374725   -0.075195000    0.04384505    0.157038750    0.42351580
  a_society.6   -0.748647275   -0.450334250   -0.30546150   -0.171585500    0.04863471
  a_society.7   -0.184076100    0.031043400    0.14236900    0.258296000    0.51617360
  a_society.8   -0.581717850   -0.293401000   -0.16858900   -0.053967075    0.15610918
  a_society.9   -0.057622205    0.158958750    0.26633100    0.383952500    0.62353485
 a_society.10   -0.712927525   -0.261140500   -0.08487710    0.077410825    0.43822993
sigma_society    0.116342450    0.229074000    0.29286450    0.379474750    0.64303205</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m12.6d/"><span class="direction">Previous</span><span class="title">m12.6d</span></a><a class="next" href="../m12.6s2/"><span class="direction">Next</span><span class="title">m12.6s2</span></a></footer></article></body></html>
