<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6.1s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2d/">m4.2d</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5d1/">m4.5d1</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/m5.1d/">m5.1d</a></li><li><a class="toctext" href="../../05/m5.1s/">m5.1s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1/">m8.1</a></li><li><a class="toctext" href="../../08/m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li class="current"><a class="toctext" href>m12.6.1s</a><ul class="internal"></ul></li><li><a class="toctext" href="../m12.6.2s/">m12.6.2s</a></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6.1s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6.1s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6.1s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col logpop, set log() for population data</p><div><pre><code class="language-julia">d[:logpop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;

first(d, 5)

m12_6_1 = &quot;
data{
    int total_tools[10];
    real logpop[10];
    int society[10];
}
parameters{
    real a;
    real bp;
    vector[10] a_society;
    real&lt;lower=0&gt; sigma_society;
}
model{
    vector[10] mu;
    sigma_society ~ cauchy( 0 , 1 );
    a_society ~ normal( 0 , sigma_society );
    bp ~ normal( 0 , 1 );
    a ~ normal( 0 , 10 );
    for ( i in 1:10 ) {
        mu[i] = a + a_society[society[i]] + bp * logpop[i];
        mu[i] = exp(mu[i]);
    }
    total_tools ~ poisson( mu );
}
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6.1&quot;,  model=m12_6_1, num_warmup=2000,
num_samples=2000, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_1_data = Dict(&quot;total_tools&quot; =&gt; d[:total_tools], &quot;logpop&quot; =&gt; d[:logpop], &quot;society&quot; =&gt; d[:society]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_1_data, ProjDir, diagnostics=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.hpp
Model name=m12_6_1_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a
Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
Exception: normal_lpdf: Scale parameter is 0, but must be &gt; 0!  (in &#39;/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.1.stan&#39; at line 15)

If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.


Calling /home/travis/cmdstan/bin/stansummary to infer across chains.

Inference for Stan model: m12_6_1_model
4 chains: each with iter=(2000,2000,2000,2000); warmup=(0,0,0,0); thin=(1,1,1,1); 8000 iterations saved.

Warmup took (0.78, 0.75, 0.77, 0.75) seconds, 3.1 seconds total
Sampling took (0.92, 0.86, 0.87, 0.86) seconds, 3.5 seconds total

                    Mean     MCSE   StdDev        5%       50%       95%    N_Eff  N_Eff/s    R_hat
lp__             9.3e+02  7.3e-02  3.1e+00   9.2e+02   9.3e+02   9.3e+02  1.8e+03  5.1e+02  1.0e+00
accept_stat__    9.4e-01  8.7e-04  8.1e-02   7.7e-01   9.8e-01   1.0e+00  8.7e+03  2.5e+03  1.0e+00
stepsize__       4.8e-02  2.6e-04  3.7e-04   4.8e-02   4.8e-02   4.9e-02  2.0e+00  5.7e-01  2.0e+12
treedepth__      5.9e+00  7.7e-03  4.2e-01   5.0e+00   6.0e+00   6.0e+00  2.9e+03  8.4e+02  1.0e+00
n_leapfrog__     7.3e+01  5.5e-01  3.3e+01   3.1e+01   6.3e+01   1.3e+02  3.5e+03  1.0e+03  1.0e+00
divergent__      0.0e+00     -nan  0.0e+00   0.0e+00   0.0e+00   0.0e+00     -nan     -nan     -nan
energy__        -9.2e+02  9.1e-02  4.0e+00  -9.3e+02  -9.2e+02  -9.1e+02  1.9e+03  5.5e+02  1.0e+00
a                1.1e+00  1.5e-02  7.4e-01  -1.5e-01   1.1e+00   2.2e+00  2.3e+03  6.6e+02  1.0e+00
bp               2.6e-01  1.7e-03  8.0e-02   1.4e-01   2.6e-01   4.0e-01  2.4e+03  6.7e+02  1.0e+00
a_society[1]    -2.0e-01  4.1e-03  2.4e-01  -6.2e-01  -1.9e-01   1.6e-01  3.5e+03  9.9e+02  1.0e+00
a_society[2]     4.5e-02  3.7e-03  2.2e-01  -3.1e-01   4.0e-02   4.0e-01  3.4e+03  9.6e+02  1.0e+00
a_society[3]    -4.5e-02  3.0e-03  1.9e-01  -3.7e-01  -4.2e-02   2.7e-01  4.3e+03  1.2e+03  1.0e+00
a_society[4]     3.3e-01  3.6e-03  1.9e-01   4.2e-02   3.2e-01   6.5e-01  2.7e+03  7.7e+02  1.0e+00
a_society[5]     4.3e-02  2.8e-03  1.8e-01  -2.4e-01   4.0e-02   3.4e-01  4.0e+03  1.2e+03  1.0e+00
a_society[6]    -3.2e-01  3.4e-03  2.1e-01  -7.0e-01  -3.1e-01  -1.2e-02  3.8e+03  1.1e+03  1.0e+00
a_society[7]     1.5e-01  2.9e-03  1.7e-01  -1.3e-01   1.4e-01   4.4e-01  3.6e+03  1.0e+03  1.0e+00
a_society[8]    -1.7e-01  2.7e-03  1.8e-01  -4.9e-01  -1.7e-01   1.2e-01  4.4e+03  1.3e+03  1.0e+00
a_society[9]     2.7e-01  3.0e-03  1.7e-01   4.2e-03   2.6e-01   5.7e-01  3.3e+03  9.4e+02  1.0e+00
a_society[10]   -1.0e-01  5.7e-03  2.9e-01  -5.9e-01  -8.6e-02   3.5e-01  2.6e+03  7.4e+02  1.0e+00
sigma_society    3.1e-01  2.9e-03  1.3e-01   1.4e-01   2.9e-01   5.4e-01  2.0e+03  5.6e+02  1.0e+00

Samples were drawn using hmc with nuts.
For each parameter, N_Eff is a crude measure of effective sample size,
and R_hat is the potential scale reduction factor on split chains (at
convergence, R_hat=1).</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:2000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 2000

Empirical Posterior Estimates:
                   Mean            SD          Naive SE         MCSE          ESS
         lp__  927.850257125  3.06504044971 0.034268193997 0.072099578126 1807.20314
accept_stat__    0.941353120  0.08072573712 0.000902541179 0.001139021636 2000.00000
   stepsize__    0.048231275  0.00037268774 0.000004166776 0.000041928026   79.00988
  treedepth__    5.920000000  0.41637923995 0.004655261425 0.008370381780 2000.00000
 n_leapfrog__   73.362000000 32.58879730389 0.364353830382 0.588673213166 2000.00000
  divergent__    0.000000000  0.00000000000 0.000000000000 0.000000000000        NaN
     energy__ -921.294370875  3.98521211908 0.044556026015 0.091384377469 1901.77428
            a    1.089565284  0.73888315552 0.008260964816 0.013922185424 2000.00000
           bp    0.262412402  0.08033074097 0.000898124987 0.001509314063 2000.00000
  a_society.1   -0.203927994  0.23908532338 0.002673055178 0.004486810171 2000.00000
  a_society.2    0.045321916  0.21604702065 0.002415479123 0.003429195899 2000.00000
  a_society.3   -0.044844365  0.19487868023 0.002178809882 0.002621939627 2000.00000
  a_society.4    0.328763132  0.18614270476 0.002081138707 0.003443590326 2000.00000
  a_society.5    0.043180424  0.17722130335 0.001981394407 0.002486354030 2000.00000
  a_society.6   -0.320815475  0.21012972119 0.002349321703 0.003759776932 2000.00000
  a_society.7    0.145311203  0.17231706058 0.001926563306 0.002750518483 2000.00000
  a_society.8   -0.173847765  0.18301250848 0.002046142049 0.002834069581 2000.00000
  a_society.9    0.273064242  0.17374393431 0.001942516239 0.003033720594 2000.00000
 a_society.10   -0.099530504  0.29218226872 0.003266697073 0.005526507897 2000.00000
sigma_society    0.311219215  0.12656367611 0.001415024916 0.002948772253 1842.19542

Quantiles:
                   2.5%          25.0%         50.0%          75.0%          97.5%
         lp__  920.978825000  926.01550000  928.17300000  930.025250000  932.908200000
accept_stat__    0.706788400    0.91758850    0.97640900    0.996418750    0.999969025
   stepsize__    0.047784700    0.04791235    0.04822590    0.048544825    0.048688600
  treedepth__    5.000000000    6.00000000    6.00000000    6.000000000    7.000000000
 n_leapfrog__   31.000000000   63.00000000   63.00000000   63.000000000  127.000000000
  divergent__    0.000000000    0.00000000    0.00000000    0.000000000    0.000000000
     energy__ -928.047025000 -924.16525000 -921.60650000 -918.812000000 -912.608300000
            a   -0.475254600    0.65967050    1.12105000    1.552290000    2.495384750
           bp    0.109378750    0.21250300    0.26008950    0.308598500    0.428475550
  a_society.1   -0.728279375   -0.34400050   -0.18931450   -0.047073400    0.231927925
  a_society.2   -0.366870900   -0.09199235    0.04044845    0.177612500    0.494074050
  a_society.3   -0.439807075   -0.16839875   -0.04197545    0.077967025    0.342179650
  a_society.4   -0.008792915    0.20057000    0.31818950    0.446426750    0.722618250
  a_society.5   -0.305595800   -0.07283205    0.04007350    0.159631000    0.396366150
  a_society.6   -0.780431550   -0.44935350   -0.30516900   -0.174915000    0.040338237
  a_society.7   -0.185197775    0.03266560    0.13787100    0.251918250    0.507490700
  a_society.8   -0.553785425   -0.28907150   -0.16630450   -0.051093400    0.167812850
  a_society.9   -0.046794585    0.15541075    0.26242050    0.382453750    0.636283475
 a_society.10   -0.707078150   -0.26306400   -0.08607915    0.069375425    0.467122700
sigma_society    0.122665275    0.22461300    0.29244400    0.373720500    0.614699950</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../08/m8.3/"><span class="direction">Previous</span><span class="title">m8.3</span></a><a class="next" href="../m12.6.2s/"><span class="direction">Next</span><span class="title">m12.6.2s</span></a></footer></article></body></html>
