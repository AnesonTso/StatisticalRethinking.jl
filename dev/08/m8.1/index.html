<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m8.1 · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2d/">m4.2d</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5d1/">m4.5d1</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/clip-01d/">clip-01d</a></li><li><a class="toctext" href="../../05/clip-01s/">clip-01s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li class="current"><a class="toctext" href>m8.1</a><ul class="internal"></ul></li><li><a class="toctext" href="../m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12.6.1s/">m12.6.1s</a></li><li><a class="toctext" href="../../12/m12.6.2s/">m12.6.2s</a></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 08</li><li><a href>m8.1</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/docs/src/08/m8.1.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m8.1</span><a class="fa fa-bars" href="#"></a></div></header><h3><a class="nav-anchor" id="m8.1stan-1" href="#m8.1stan-1">m8.1stan</a></h3><p>m8.1stan is the first model in the Statistical Rethinking book (pp. 249) using Stan.</p><p>Here we will use Turing&#39;s NUTS support, which is currently (2018) the originalNUTS by <a href="08/ http:/www.stat.columbia.edu/~gelman/research/published/nuts.pdf">Hoffman &amp; Gelman</a> and not the one that&#39;s in Stan 2.18.2, i.e., Appendix A.5 in: https://arxiv.org/abs/1701.02434</p><p>The StatisticalRethinking pkg imports modules such as CSV and DataFrames</p><pre><code class="language-julia">using StatisticalRethinking, Turing

Turing.setadbackend(:reverse_diff);
Turing.turnprogress(false);</code></pre><pre><code class="language-none">loaded


┌ Info: [Turing]: global PROGRESS is set as false
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/Turing.jl:81</code></pre><p>Read in the <code>rugged</code> data as a DataFrame</p><pre><code class="language-julia">d = CSV.read(rel_path(&quot;..&quot;, &quot;data&quot;, &quot;rugged.csv&quot;), delim=&#39;;&#39;);</code></pre><p>Show size of the DataFrame (should be 234x51)</p><pre><code class="language-julia">size(d)</code></pre><pre><code class="language-none">(234, 51)</code></pre><p>Apply log() to each element in rgdppc_2000 column and add it as a new column</p><pre><code class="language-julia">d = hcat(d, map(log, d[Symbol(&quot;rgdppc_2000&quot;)]));</code></pre><p>Rename our col x1 =&gt; log_gdp</p><pre><code class="language-julia">rename!(d, :x1 =&gt; :log_gdp);</code></pre><p>Now we need to drop every row where rgdppc_2000 == missing</p><p>When this (https://github.com/JuliaData/DataFrames.jl/pull/1546) hits DataFrame it&#39;ll be conceptually easier: i.e., completecases!(d, :rgdppc_2000)</p><pre><code class="language-julia">notisnan(e) = !ismissing(e)
dd = d[map(notisnan, d[:rgdppc_2000]), :];</code></pre><p>Updated DataFrame dd size (should equal 170 x 52)</p><pre><code class="language-julia">size(dd)</code></pre><pre><code class="language-none">(170, 52)</code></pre><p>Define the Turing model</p><pre><code class="language-julia">@model m8_1stan(y, x₁, x₂) = begin
    σ ~ Truncated(Cauchy(0, 2), 0, Inf)
    βR ~ Normal(0, 10)
    βA ~ Normal(0, 10)
    βAR ~ Normal(0, 10)
    α ~ Normal(0, 100)

    for i ∈ 1:length(y)
        y[i] ~ Normal(α + βR * x₁[i] + βA * x₂[i] + βAR * x₁[i] * x₂[i], σ)
    end
end;</code></pre><p>Test to see that the model is sane. Use 2000 for now, as in the book. Need to set the same stepsize and adapt_delta as in Stan...</p><p>Use Turing mcmc</p><pre><code class="language-julia">posterior = sample(m8_1stan(dd[:log_gdp], dd[:rugged], dd[:cont_africa]),
    Turing.NUTS(2000, 200, 0.95));
# Describe the posterior samples
describe(posterior)</code></pre><pre><code class="language-none">┌ Info: [Turing] looking for good initial eps...
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/support/hmc_core.jl:246
[NUTS{Turing.FluxTrackerAD,Union{}}] found initial ϵ: 0.05
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/support/hmc_core.jl:291
┌ Info:  Adapted ϵ = 0.02494112896959952, std = [1.0, 1.0, 1.0, 1.0, 1.0]; 200 iterations is used for adaption.
└ @ Turing /Users/rob/.julia/packages/Turing/xp88X/src/samplers/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 284.69474977300035;
  #lf / sample        = 0.0015;
  #evals / sample     = 47.82;
  pre-cond. metric    = [1.0, 1.0, 1.0, 1.0, 1.0].
Iterations = 1:2000
Thinning interval = 1
Chains = 1
Samples per chain = 2000

Empirical Posterior Estimates:
              Mean          SD         Naive SE       MCSE         ESS   
       α    9.20431457  0.409119788 0.00914819658 0.0277999222  216.57774
  lf_num    0.00150000  0.067082039 0.00150000000 0.0015000000 2000.00000
      βA   -1.92760777  0.347059686 0.00776049050 0.0286062609  147.19266
      βR   -0.20010279  0.111203536 0.00248658666 0.0076298260  212.42612
       σ    0.96306823  0.240119729 0.00536924037 0.0150168225  255.68167
 elapsed    0.14234737  0.166759748 0.00372886132 0.0080236235  431.95785
 epsilon    0.02569079  0.013752776 0.00030752142 0.0005170151  707.57793
eval_num   47.82000000 26.804754194 0.59937252499 0.6517587542 1691.41396
     βAR    0.39846959  0.186980959 0.00418102135 0.0062014197  909.10178
      lp -249.61661241 16.615338561 0.37153026491 1.1359823316  213.93175
  lf_eps    0.02569079  0.013752776 0.00030752142 0.0005170151  707.57793

Quantiles:
              2.5%           25.0%         50.0%         75.0%         97.5%    
       α    8.942664429    9.132459560    9.23019097    9.32077476    9.49302098
  lf_num    0.000000000    0.000000000    0.00000000    0.00000000    0.00000000
      βA   -2.370022641   -2.094903734   -1.95759873   -1.79584367   -1.47003212
      βR   -0.355302986   -0.255220809   -0.20584364   -0.15294067   -0.04647507
       σ    0.850984812    0.911530362    0.94640859    0.98396223    1.06767308
 elapsed    0.028388287    0.060682055    0.11541753    0.17330208    0.36332965
 epsilon    0.022344993    0.024941129    0.02494113    0.02494113    0.03243229
eval_num   10.000000000   22.000000000   46.00000000   46.00000000   94.00000000
     βAR    0.134905453    0.310059030    0.39529263    0.48317478    0.66063326
      lp -253.227027174 -249.344374789 -248.14662559 -247.30631894 -246.41399276
  lf_eps    0.022344993    0.024941129    0.02494113    0.02494113    0.03243229</code></pre><p>Example of a Turing run simulation output</p><p>Here&#39;s the ulam() output from rethinking (note that in above output the SD value is too large).</p><pre><code class="language-julia">m81rethinking = &quot;
       Mean StdDev lower 0.89 upper 0.89 n_eff Rhat
 a      9.24   0.14       9.03       9.47   291    1
 bR    -0.21   0.08      -0.32      -0.07   306    1
 bA    -1.97   0.23      -2.31      -1.58   351    1
 bAR    0.40   0.13       0.20       0.63   350    1
 sigma  0.95   0.05       0.86       1.03   566    1
&quot;;#-</code></pre><p><em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../05/clip-01s/"><span class="direction">Previous</span><span class="title">clip-01s</span></a><a class="next" href="../m8.3/"><span class="direction">Next</span><span class="title">m8.3</span></a></footer></article></body></html>
