<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m8.1s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/m5.1d/">m5.1d</a></li><li><a class="toctext" href="../../05/m5.1s/">m5.1s</a></li><li><a class="toctext" href="../../05/m5.6d/">m5.6d</a></li><li><a class="toctext" href="../../05/m5.6s/">m5.6s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../m8.1d/">m8.1d</a></li><li class="current"><a class="toctext" href>m8.1s</a><ul class="internal"></ul></li><li><a class="toctext" href="../m8.1t/">m8.1t</a></li><li><a class="toctext" href="../m8.3t/">m8.3t</a></li><li><a class="toctext" href="../m8.5s/">m8.5s</a></li><li><a class="toctext" href="../m8.8s/">m8.8s</a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li><a class="toctext" href="../../10/m10.01s/">m10.01s</a></li><li><a class="toctext" href="../../10/m10.02d/">m10.02d</a></li><li><a class="toctext" href="../../10/m10.02s/">m10.02s</a></li><li><a class="toctext" href="../../10/m10.04s/">m10.04s</a></li></ul></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12.6.1s/">m12.6.1s</a></li><li><a class="toctext" href="../../12/m12.6.2s/">m12.6.2s</a></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 08</li><li><a href>m8.1s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/08/m8.1s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m8.1s</span><a class="fa fa-bars" href="#"></a></div></header><p>Load Julia packages (libraries) needed  for the snippets in chapter 0</p><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain
gr(size=(500,500));</code></pre></div><p>CmdStan uses a tmp directory to store the output of cmdstan</p><div><pre><code class="language-julia">ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;08&quot;)
cd(ProjDir)</code></pre></div><h3><a class="nav-anchor" id="snippet-5.1-1" href="#snippet-5.1-1">snippet 5.1</a></h3><div><pre><code class="language-julia">d = CSV.read(rel_path(&quot;..&quot;, &quot;data&quot;, &quot;rugged.csv&quot;), delim=&#39;;&#39;);
df = convert(DataFrame, d);

dcc = filter(row -&gt; !(ismissing(row[:rgdppc_2000])), df)
dcc[:log_gdp] = log.(dcc[:rgdppc_2000])
dcc[:cont_africa] = Array{Float64}(convert(Array{Int}, dcc[:cont_africa]))
dcc[:rugged] = convert(Array{Float64}, dcc[:rugged])
first(dcc[[:rugged, :cont_africa, :log_gdp]], 5)</code></pre><table class="data-frame"><thead><tr><th></th><th>rugged</th><th>cont_africa</th><th>log_gdp</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>5 rows × 3 columns</p><tr><th>1</th><td>0.858</td><td>1.0</td><td>7.49261</td></tr><tr><th>2</th><td>3.427</td><td>0.0</td><td>8.21693</td></tr><tr><th>3</th><td>0.769</td><td>0.0</td><td>9.93326</td></tr><tr><th>4</th><td>0.775</td><td>0.0</td><td>9.40703</td></tr><tr><th>5</th><td>2.688</td><td>0.0</td><td>7.79234</td></tr></tbody></table></div><p>Define the Stan language model</p><div><pre><code class="language-julia">m_8_1_model = &quot;
data{
    int N;
    vector[N] log_gdp;
    vector[N] cont_africa;
    vector[N] rugged;
    vector[N] rugged_cont_africa;
}
parameters{
    real a;
    real bR;
    real bA;
    real bAR;
    real sigma;
}
model{
    vector[N] mu = a + bR * rugged + bA * cont_africa + bAR * rugged_cont_africa;
    sigma ~ uniform( 0 , 10 );
    bAR ~ normal( 0 , 10 );
    bA ~ normal( 0 , 10 );
    bR ~ normal( 0 , 10 );
    a ~ normal( 0 , 100 );
    log_gdp ~ normal( mu , sigma );
}
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m_8_1_model&quot;,
monitors = [&quot;a&quot;, &quot;bR&quot;, &quot;bA&quot;, &quot;bAR&quot;, &quot;sigma&quot;],
model=m_8_1_model, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m_8_1_data = Dict(&quot;N&quot; =&gt; size(dcc, 1),
&quot;log_gdp&quot; =&gt; dcc[:log_gdp],  &quot;rugged&quot; =&gt; dcc[:rugged],
&quot;cont_africa&quot; =&gt; dcc[:cont_africa],
&quot;rugged_cont_africa&quot; =&gt; dcc[:rugged] .* dcc[:cont_africa] );</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m_8_1_data, ProjDir, diagnostics=false,
  summary=true, CmdStanDir=CMDSTAN_HOME);</code></pre></div><p>Result rethinking</p><div><pre><code class="language-julia">rethinking = &quot;
       mean   sd  5.5% 94.5% n_eff Rhat
a      9.22 0.14  9.00  9.46   282    1
bR    -0.21 0.08 -0.33 -0.08   275    1
bA    -1.94 0.24 -2.33 -1.59   268    1
bAR    0.40 0.14  0.18  0.62   271    1
sigma  0.96 0.05  0.87  1.04   339    1
&quot;</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.hpp
Model name=m_8_1_model_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/08/tmp/m_8_1_model.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a

Calling /home/travis/cmdstan/bin/stansummary to infer across chains.

Inference for Stan model: m_8_1_model_model
4 chains: each with iter=(1000,1000,1000,1000); warmup=(0,0,0,0); thin=(1,1,1,1); 4000 iterations saved.

Warmup took (0.37, 0.37, 0.36, 0.35) seconds, 1.5 seconds total
Sampling took (0.35, 0.42, 0.45, 0.40) seconds, 1.6 seconds total

                 Mean     MCSE  StdDev     5%    50%       95%    N_Eff  N_Eff/s    R_hat
lp__              -76  4.0e-02     1.6    -79    -75  -7.4e+01  1.7e+03  1.0e+03  1.0e+00
accept_stat__    0.93  2.5e-03   0.094   0.73   0.96   1.0e+00  1.5e+03  9.1e+02  1.0e+00
stepsize__       0.33  2.2e-02   0.031   0.30   0.34   3.8e-01  2.0e+00  1.2e+00  6.5e+13
treedepth__       3.2  6.6e-02    0.64    2.0    3.0   4.0e+00  9.5e+01  5.9e+01  1.0e+00
n_leapfrog__       12  5.9e-01     6.5    3.0     15   2.3e+01  1.2e+02  7.5e+01  1.0e+00
divergent__      0.00     -nan    0.00   0.00   0.00   0.0e+00     -nan     -nan     -nan
energy__           78  5.8e-02     2.3     75     78   8.3e+01  1.5e+03  9.4e+02  1.0e+00
a                 9.2  3.2e-03    0.14    9.0    9.2   9.4e+00  1.9e+03  1.2e+03  1.0e+00
bR              -0.20  1.8e-03   0.078  -0.33  -0.20  -7.6e-02  1.9e+03  1.2e+03  1.0e+00
bA               -1.9  5.0e-03    0.22   -2.3   -1.9  -1.6e+00  1.9e+03  1.2e+03  1.0e+00
bAR              0.39  3.0e-03    0.13   0.17   0.39   6.1e-01  1.9e+03  1.2e+03  1.0e+00
sigma            0.95  1.1e-03   0.054   0.87   0.95   1.0e+00  2.4e+03  1.5e+03  1.0e+00

Samples were drawn using hmc with nuts.
For each parameter, N_Eff is a crude measure of effective sample size,
and R_hat is the potential scale reduction factor on split chains (at
convergence, R_hat=1).

&quot;\n       mean   sd  5.5% 94.5% n_eff Rhat\na      9.22 0.14  9.00  9.46   282    1\nbR    -0.21 0.08 -0.33 -0.08   275    1\nbA    -1.94 0.24 -2.33 -1.59   268    1\nbAR    0.40 0.14  0.18  0.62   271    1\nsigma  0.96 0.05  0.87  1.04   339    1\n&quot;</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
          Mean        SD        Naive SE       MCSE      ESS
    a  9.22213510 0.13846493 0.00218932284 0.0034956453 1000
   bR -0.20157802 0.07755184 0.00122620224 0.0018165595 1000
   bA -1.94429869 0.22042859 0.00348528199 0.0059020633 1000
  bAR  0.39137957 0.13127005 0.00207556172 0.0036144101 1000
sigma  0.95136606 0.05377258 0.00085021914 0.0008217444 1000

Quantiles:
         2.5%       25.0%       50.0%      75.0%        97.5%
    a  8.9564680  9.12756000  9.2207050  9.31631750  9.495615500
   bR -0.3578311 -0.25385625 -0.2023165 -0.14742075 -0.054909867
   bA -2.3707903 -2.09599750 -1.9446850 -1.79564500 -1.523879250
  bAR  0.1302897  0.30400825  0.3915855  0.47841400  0.649234525
sigma  0.8530234  0.91457250  0.9494045  0.98504325  1.066846500</code></pre></div><p>End of <code>08/m8.1s.jl</code></p><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m8.1d/"><span class="direction">Previous</span><span class="title">m8.1d</span></a><a class="next" href="../m8.1t/"><span class="direction">Next</span><span class="title">m8.1t</span></a></footer></article></body></html>
