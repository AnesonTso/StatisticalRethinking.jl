<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6.2s · StatisticalRethinking.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StatisticalRethinking.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><a class="toctext" href="../../layout/">Layout</a></li><li><a class="toctext" href="../../versions/">Versions</a></li><li><a class="toctext" href="../../notes/">Notes</a></li><li><a class="toctext" href="../../acknowledgements/">Acknowledgements</a></li><li><a class="toctext" href="../../references/">References</a></li><li><span class="toctext">Chapter 00</span><ul><li><a class="toctext" href="../../00/clip-01-03/">clip-01-03</a></li><li><a class="toctext" href="../../00/clip-04-05/">clip-04-05</a></li></ul></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/clip-01-02/">clip-01-02</a></li><li><a class="toctext" href="../../02/clip-03-05/">clip-03-05</a></li><li><a class="toctext" href="../../02/clip-06-07/">clip-06-07</a></li><li><a class="toctext" href="../../02/clip-08d/">clip-08d</a></li><li><a class="toctext" href="../../02/clip-08s/">clip-08s</a></li><li><a class="toctext" href="../../02/clip-08t/">clip-08t</a></li></ul></li><li><span class="toctext">Chapter 03</span><ul><li><a class="toctext" href="../../03/clip-01/">clip-01</a></li><li><a class="toctext" href="../../03/clip-02-05/">clip-02-05</a></li><li><a class="toctext" href="../../03/clip-05s/">clip-05s</a></li><li><a class="toctext" href="../../03/clip-06-16s/">clip-06-16s</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.1d/">m4.1d</a></li><li><a class="toctext" href="../../04/m4.1s/">m4.1s</a></li><li><a class="toctext" href="../../04/m4.2d/">m4.2d</a></li><li><a class="toctext" href="../../04/m4.2s/">m4.2s</a></li><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li><li><a class="toctext" href="../../04/m4.3s/">m4.3s</a></li><li><a class="toctext" href="../../04/m4.4s/">m4.4s</a></li><li><a class="toctext" href="../../04/m4.5d/">m4.5d</a></li><li><a class="toctext" href="../../04/m4.5d1/">m4.5d1</a></li><li><a class="toctext" href="../../04/m4.5s/">m4.5s</a></li><li><a class="toctext" href="../../04/clip-01-06/">clip-01-06</a></li><li><a class="toctext" href="../../04/clip-07-13s/">clip-07-13s</a></li><li><a class="toctext" href="../../04/clip-14-20/">clip-14-20</a></li><li><a class="toctext" href="../../04/clip-21-23/">clip-21-23</a></li><li><a class="toctext" href="../../04/clip-24-29s/">clip-24-29s</a></li><li><a class="toctext" href="../../04/clip-30s/">clip-30s</a></li><li><a class="toctext" href="../../04/clip-38s/">clip-38s</a></li><li><a class="toctext" href="../../04/clip-43s/">clip-43s</a></li><li><a class="toctext" href="../../04/clip-45-47s/">clip-45-47s</a></li><li><a class="toctext" href="../../04/clip-48-54s/">clip-48-54s</a></li></ul></li><li><span class="toctext">Chapter 05</span><ul><li><a class="toctext" href="../../05/m5.1d/">m5.1d</a></li><li><a class="toctext" href="../../05/m5.1s/">m5.1s</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1/">m8.1</a></li><li><a class="toctext" href="../../08/m8.3/">m8.3</a></li></ul></li><li><span class="toctext">Chapter 10</span></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../m12.6.1s/">m12.6.1s</a></li><li class="current"><a class="toctext" href>m12.6.2s</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 13</span><ul><li><a class="toctext" href="../../13/m13.2s/">m13.2s</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6.2s</a></li></ul><a class="edit-page" href="https://github.com/StanJulia/StatisticalRethinking.jl/blob/master/scripts/12/m12.6.2s.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6.2s</span><a class="fa fa-bars" href="#"></a></div></header><div><pre><code class="language-julia">using StatisticalRethinking
using CmdStan, StanMCMCChain

ProjDir = rel_path(&quot;..&quot;, &quot;scripts&quot;, &quot;12&quot;)

d = CSV.read(rel_path( &quot;..&quot;, &quot;data&quot;,  &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">(10, 5)</code></pre></div><p>New col log_pop, set log() for population data</p><div><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;

first(d, 5)

m12_6 = &quot;
  data {
    int N;
    int T[N];
    int N_societies;
    int society[N];
    int P[N];
  }
  parameters {
    real alpha;
    vector[N_societies] a_society;
    real bp;
    real&lt;lower=0&gt; sigma_society;
  }
  model {
    vector[N] mu;
    target += normal_lpdf(alpha | 0, 10);
    target += normal_lpdf(bp | 0, 1);
    target += cauchy_lpdf(sigma_society | 0, 1);
    target += normal_lpdf(a_society | 0, sigma_society);
    for(i in 1:N) mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
    target += poisson_log_lpmf(T | mu);
  }
  generated quantities {
    vector[N] log_lik;
    {
    vector[N] mu;
    for(i in 1:N) {
      mu[i] = alpha + a_society[society[i]] + bp * log(P[i]);
      log_lik[i] = poisson_log_lpmf(T[i] | mu[i]);
    }
    }
  }
&quot;;</code></pre></div><p>Define the Stanmodel and set the output format to :mcmcchain.</p><div><pre><code class="language-julia">stanmodel = Stanmodel(name=&quot;m12.6&quot;,  model=m12_6, output_format=:mcmcchain);</code></pre><pre><code class="language-none">=====&gt; /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12


File /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan will be updated.</code></pre></div><p>Input data for cmdstan</p><div><pre><code class="language-julia">m12_6_data = Dict(&quot;N&quot; =&gt; size(d, 1), &quot;T&quot; =&gt; d[:total_tools], &quot;N_societies&quot; =&gt; 10, &quot;society&quot; =&gt; d[:society], &quot;P&quot; =&gt; d[:population]);</code></pre></div><p>Sample using cmdstan</p><div><pre><code class="language-julia">rc, chn, cnames = stan(stanmodel, m12_6_data, ProjDir, diagnostics=false, summary=false, CmdStanDir=CMDSTAN_HOME);</code></pre><pre><code class="language-none">

--- Translating Stan model to C++ code ---
bin/stanc  /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan --o=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp
Model name=m12_6_model
Input file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan
Output file=/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp

--- Linking C++ model ---
g++ -Wall -I . -isystem stan/lib/stan_math/lib/eigen_3.3.3 -isystem stan/lib/stan_math/lib/boost_1.66.0 -isystem stan/lib/stan_math/lib/sundials_3.1.0/include -std=c++1y -DBOOST_RESULT_OF_USE_TR1 -DBOOST_NO_DECLTYPE -DBOOST_DISABLE_ASSERTS -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION -Wno-unused-function -Wno-uninitialized -I src -isystem stan/src -isystem stan/lib/stan_math/ -DFUSION_MAX_VECTOR_SIZE=12 -Wno-unused-local-typedefs -DEIGEN_NO_DEBUG -DNO_FPRINTF_OUTPUT -pipe   src/cmdstan/main.cpp  -O3 -o /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6 -include /home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.hpp stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_nvecserial.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_cvodes.a stan/lib/stan_math/lib/sundials_3.1.0/lib/libsundials_idas.a
Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
Exception: normal_lpdf: Scale parameter is 0, but must be &gt; 0!  (in &#39;/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan&#39; at line 19)

If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.

Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
Exception: normal_lpdf: Scale parameter is 0, but must be &gt; 0!  (in &#39;/home/travis/build/StanJulia/StatisticalRethinking.jl/docs/build/12/tmp/m12.6.stan&#39; at line 19)

If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre></div><p>Describe the draws</p><div><pre><code class="language-julia">describe(chn)</code></pre><pre><code class="language-none">Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
                   Mean           SD         Naive SE         MCSE         ESS
         lp__ -39.562959650  3.1491899702 0.049793065451 0.11812390337  710.758627
accept_stat__   0.945105648  0.0798443887 0.001262450634 0.00152356350 1000.000000
   stepsize__   0.050945250  0.0031556803 0.000049895686 0.00050525009   39.009752
  treedepth__   5.887250000  0.4786383929 0.007567937486 0.02178857469  482.566778
 n_leapfrog__  74.242000000 35.8324214449 0.566560329225 1.17194289701  934.844576
  divergent__   0.000000000  0.0000000000 0.000000000000 0.00000000000         NaN
     energy__  46.049284850  4.0833322624 0.064563151962 0.13663432559  893.119980
        alpha   1.104347346  0.7470845410 0.011812443772 0.02810752070  706.471134
  a_society.1  -0.210546060  0.2461050278 0.003891262157 0.00696645487 1000.000000
  a_society.2   0.049200051  0.2203300563 0.003483724075 0.00627058228 1000.000000
  a_society.3  -0.046380756  0.1959283029 0.003097898477 0.00429326843 1000.000000
  a_society.4   0.332920670  0.1887195410 0.002983917943 0.00502628298 1000.000000
  a_society.5   0.046683758  0.1771038073 0.002800257066 0.00311785957 1000.000000
  a_society.6  -0.320419548  0.2057182234 0.003252690710 0.00509113540 1000.000000
  a_society.7   0.153667097  0.1733237523 0.002740489150 0.00303644463 1000.000000
  a_society.8  -0.171827327  0.1851432050 0.002927371105 0.00395367323 1000.000000
  a_society.9   0.282121008  0.1723859291 0.002725660862 0.00480547919 1000.000000
 a_society.10  -0.090164777  0.2857730452 0.004518468583 0.01049497816  741.445864
           bp   0.260263567  0.0808054275 0.001277645991 0.00308655684  685.381704
sigma_society   0.313505416  0.1258197635 0.001989385137 0.00439175006  820.771933
    log_lik.1  -2.739607785  0.6750626099 0.010673677053 0.01527205152 1000.000000
    log_lik.2  -2.815172130  0.4972706677 0.007862539618 0.00948622219 1000.000000
    log_lik.3  -2.860315478  0.4990810482 0.007891164247 0.00996590684 1000.000000
    log_lik.4  -3.560530812  0.9496310468 0.015014985224 0.02519084380 1000.000000
    log_lik.5  -3.047037425  0.5521914351 0.008730913197 0.01044652436 1000.000000
    log_lik.6  -3.146284585  0.9156283915 0.014477356037 0.02429127163 1000.000000
    log_lik.7  -3.209157927  0.6026751354 0.009529130584 0.01258926891 1000.000000
    log_lik.8  -3.040843090  0.6153145985 0.009728978044 0.01269643645 1000.000000
    log_lik.9  -3.526126522  0.8174323284 0.012924739953 0.02605816480  984.047282
   log_lik.10  -3.565173713  0.7271016872 0.011496487110 0.01591062946 1000.000000

Quantiles:
                   2.5%          25.0%         50.0%        75.0%         97.5%
         lp__ -46.2076475000 -41.459600000 -39.33235000 -37.436575000 -34.333975000
accept_stat__   0.7095069500   0.926985500   0.97909600   0.996408250   0.999966000
   stepsize__   0.0469778000   0.048349475   0.05107315   0.053668925   0.054656900
  treedepth__   5.0000000000   6.000000000   6.00000000   6.000000000   7.000000000
 n_leapfrog__  31.0000000000  63.000000000  63.00000000  63.000000000 127.000000000
  divergent__   0.0000000000   0.000000000   0.00000000   0.000000000   0.000000000
     energy__  38.8389850000  43.225650000  45.89320000  48.716025000  54.570255000
        alpha  -0.4471980000   0.657627500   1.11319500   1.565800000   2.544536500
  a_society.1  -0.7426179750  -0.358311500  -0.19533000  -0.047920000   0.254408450
  a_society.2  -0.3979104750  -0.081508800   0.04529640   0.182275250   0.486452650
  a_society.3  -0.4314412250  -0.171249000  -0.04036460   0.078641175   0.332061400
  a_society.4  -0.0044964095   0.202473000   0.32571650   0.450737000   0.720017675
  a_society.5  -0.3056214250  -0.066960900   0.04162740   0.162825250   0.396181675
  a_society.6  -0.7558442500  -0.446606250  -0.30514550  -0.178139750   0.038633503
  a_society.7  -0.1769981250   0.040190550   0.14471500   0.261601750   0.521880900
  a_society.8  -0.5629052250  -0.288692500  -0.16349800  -0.048138475   0.177615500
  a_society.9  -0.0386871825   0.167622250   0.27712000   0.391419000   0.636207650
 a_society.10  -0.6671420000  -0.258011500  -0.08399095   0.080145775   0.491680025
           bp   0.1033549500   0.211139000   0.25906350   0.308452750   0.427609575
sigma_society   0.1241600000   0.227143250   0.29498100   0.375797500   0.627972800
    log_lik.1  -4.5919852500  -2.960617500  -2.48063000  -2.271520000  -2.208449750
    log_lik.2  -4.2077497500  -2.926405000  -2.62083000  -2.502767500  -2.468510000
    log_lik.3  -4.3221405000  -2.971405000  -2.66529500  -2.547090000  -2.511840000
    log_lik.4  -6.1437380000  -3.913282500  -3.19111000  -2.890967500  -2.802348750
    log_lik.5  -4.6174295000  -3.160300000  -2.83380500  -2.708397500  -2.670129500
    log_lik.6  -5.6603372500  -3.446772500  -2.80226000  -2.496395000  -2.396529750
    log_lik.7  -4.8761160000  -3.360137500  -2.98106500  -2.811587500  -2.765929750
    log_lik.8  -4.8016617500  -3.198190000  -2.80402500  -2.638190000  -2.588699250
    log_lik.9  -5.7997135000  -3.735132500  -3.20095500  -2.990220000  -2.924808750
   log_lik.10  -5.7563910000  -3.738372500  -3.27599500  -3.100682500  -3.051929750</code></pre></div><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../m12.6.1s/"><span class="direction">Previous</span><span class="title">m12.6.1s</span></a><a class="next" href="../../13/m13.2s/"><span class="direction">Next</span><span class="title">m13.2s</span></a></footer></article></body></html>
